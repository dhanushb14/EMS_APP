<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://getbootstrap.com/docs/5.3/assets/css/docs.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <link
      rel="icon"
      href="https://intellectoglobal.com/wp-content/uploads/2023/06/cropped-Intellecto-Favicon-192x192.png"
    />
    <style>
      .form-control:focus {
        border-color: #4723d9;
        box-shadow: 0 0 0 0.2rem rgba(71, 35, 217, 0.25);
      }
    </style>
    <title>IGS Employee Portal</title>
  </head>
  <body style="background-color: #e9eaef">
    <div class="container mt-5" style="margin-top: 8% !important">
      <div class="row justify-content-center">
        <div class="col-md-4">
          <div class="card">
            <div class="card-body text-center">
              <img
                src="../../../static/employee_information/assets/logo.jpg"
                alt="Logo"
                class="img-fluid mb-4"
              />
              <p class="fs-5">Enter your registered email address</p>
              <form
                class="mx-auto col-10"
                action="{% url 'send_password' %}"
                method="post"
                id="forgot-password"
              >
                {% csrf_token %}
                <div class="my-4">
                  
                  <input
                    type="email"
                    class="form-control"
                    id="email"
                    name="email"
                    placeholder="Enter Email"
                    required
                  />
                  <label for="email" class="form-label">Email</label>
                </div>
                <button
                  type="submit"
                  class="col-12 btn text-white my-4"
                  style="background-color: #4723d9 !important"
                >
                  Continue
                </button>
                <!-- Alert div -->
                <div>
                  <!-- Success alert -->
                  {% if user_exists %}
                  <div
                    class="alert alert-success alert-dismissible fade show"
                    role="alert"
                  >
                    Login credentials has been sent to your email.
                    <button
                      type="button"
                      class="btn-close"
                      data-bs-dismiss="alert"
                      aria-label="Close"
                    ></button>
                  </div>
                  <!-- Success alert end -->
                  <!-- Failed alert -->
                  {% elif user_exists == False %}
                  <div
                    class="alert alert-danger alert-dismissible fade show"
                    role="alert"
                  >
                    Invalid ! Please enter your registered email
                    <button
                      type="button"
                      class="btn-close"
                      data-bs-dismiss="alert"
                      aria-label="Close"
                    ></button>
                  </div>
                  {% endif %}
                  <!-- Failed alert end -->
                </div>
                <!-- End of Alert div -->
                <p class="mt-3">
                  Get back to login?
                  <a href="{% url 'login' %}">Login</a>
                </p>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
     $(function() {
    $('#forgot-password').submit(function(e) {
        e.preventDefault();
        var _this = $(this)
        
        $('.err-msg').remove();
        var el = $('<div>')
        el.addClass("alert alert-danger err-msg")
        el.hide()
        if (_this[0].checkValidity() == false) {
            _this[0].reportValidity();
            return false;
        }
        
        var formData = new FormData($(this)[0]);
        
        $.ajax({
            headers: {
                "X-CSRFToken": '{{csrf_token}}'
            },
            url: "{% url 'forgot_password_email' %}",
            data: formData,
            
            cache: false,
            contentType: false,
            processData: false,
            method: 'POST',
            type: 'POST',
            dataType: 'json',
            error: err => {
                console.log(err)
                alert("An error occured", 'error');
                
            },
            success: function(resp) {
                if (resp.status == 'success') {
                    el.removeClass("alert alert-danger err-msg")
                    el.addClass("alert alert-success")
                    el.text("A password reset email has been sent to your email address.")
                } else {
                    el.text("Check your Employee id and Email", 'error');
                    
                    console.error(resp)
                }
                _this.prepend(el)
                el.show('slow')
                $("html, body, .modal").scrollTop(0);
                 // Hide the message after 5 seconds
                setTimeout(function() {
                    el.hide('slow');
                }, 3000);
            },
            error: err => {
                console.log(err)
                alert("An error occured", 'error');

                // Hide the message after 5 seconds
                setTimeout(function() {
                    el.hide('slow');
                }, 3000);
                
            }
        })
    })
})
     
   </script>
  </body>
  
</html>
