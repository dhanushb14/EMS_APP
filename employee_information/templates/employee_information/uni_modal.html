{% block modal-footer %}
<style>
input[type="text"]:not(#project_name):not(#task) {
  width: 100px;
}
</style>
<style>
  .grey-background {
    background-color: grey;
}
  .small-alert {
    width: 40%;
    text-align: center;
    z-index: 1;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: rgb(138, 235, 138);
    margin: auto;
  }
  </style>
<div class="container mg-t">
  
  <div class="row" style="background-color: #ecd5ef; min-height: 7%">
    <div class="col-auto my-auto">
      <label for="start_date" class="col-form-label">Start Date</label>
    </div>
    <div class="col-auto my-auto">
      <input type="text" id="start_date" class="form-control" value={{position.start_date}} style="width: fit-content;" readonly>
    </div>
    <div class="col-auto my-auto">
      <label for="end_date" class="col-form-label">End Date</label>
    </div>
    <div class="col-auto my-auto">
      <input type="text" id="end_date" class="form-control" value={{position.end_date}}  style="width: fit-content;" readonly>
    </div>
    <div class="col-auto my-auto">
      <label for="project_name" class="col-form-label">Project Name</label>
    </div>
    <div class="col-auto my-auto">
      <input type="text" id="project_name" placeholder="Project Name / RND" class="form-control" value="{{position.project_name}}" style="width: fit-content;" readonly>
    </div>
  </div>
  <div class="row mt-5">
    <div class="table-responsive">
      <table class="table table-bordered" id="timeSheetForm">
      <thead>
        <tr class="table-secondary fw-light text-center">
          <th >Type</th>
          <th >Monday</th>
          <th >Tuesday</th>
          <th >Wednesday</th>
          <th >Thursday</th>
          <th >Friday</th>
          <th >Saturday</th>
          <th >Sunday</th>
          
          <th class="text-center">
            <button  id="addrow">+</button>
          </th>
        </tr>
      </thead>
      <tbody>
        {% for task, monday_value, tuesday_value, wednesday_value, thursday_value, friday_value, saturday_value, sunday_value in position.zipped_values %}  
        <tr id="tasknamerow">
          
          <td class="text-center">
            <input class="text-center task-input" type="text" id="task" name="task" placeholder="Task Name" value="{{task}}">
          </td>
          <td class="text-center">
            <input class="monday_value {% for item in leave.day %}{% if item == 'monday' %}grey-background{% endif %}{% endfor %}"  type="text" id="monday_value" name="monday_value" placeholder="0" style="border: none;" value="{{monday_value|default:'0'}}">
          </td>
          <td class="text-center">
            <input class="tuesday_value {% for item in leave.day %}{% if item == 'tuesday' %}grey-background{% endif %}{% endfor %}"  type="text" id="tuesday_value" name="tuesday_value" placeholder="0" style="border: none;" value="{{tuesday_value|default:'0'}}">
          </td>
          <td class="text-center">
            <input class="wednesday_value {% for item in leave.day %}{% if item == 'wednesday' %}grey-background{% endif %}{% endfor %}"  type="text" id="wednesday_value" name="wednesday_value" placeholder="0" style="border: none;" value="{{wednesday_value|default:'0'}}">
          </td>
          <td class="text-center">
            <input class="thursday_value {% for item in leave.day %}{% if item == 'thursday' %}grey-background{% endif %}{% endfor %}"  type="text" id="thursday_value" name="thursday_value" placeholder="0" style="border: none;" value="{{thursday_value|default:'0'}}">
          </td>
          <td class="text-center">
            <input class="friday_value {% for item in leave.day %}{% if item == 'friday' %}grey-background{% endif %}{% endfor %}"  type="text" id="friday_value" name="friday_value" placeholder="0" style="border: none;" value="{{friday_value|default:'0'}}">
          </td>
          <td class="text-center">
            <input class="saturday_value {% for item in leave.day %}{% if item == 'saturday' %}grey-background{% endif %}{% endfor %}"  type="text" id="saturday_value" name="saturday_value" placeholder="0" style="border: none;" value="{{saturday_value|default:'0'}}">
          </td>
          <td class="text-center">
            <input class="sunday_value {% for item in leave.day %}{% if item == 'sunday' %}grey-background{% endif %}{% endfor %}"  type="text" id="sunday_value" name="sunday_value" placeholder="0" style="border: none;" value="{{sunday_value|default:'0'}}">
          </td>
          
        </tr>
        {% endfor %}
        <tr>
          
          <td class="text-center">
            Overtime Hours
          </td>
          <td class="text-center">
            <input class="ovt_monday {% for item in leave.day %}{% if item == 'monday' %}grey-background{% endif %}{% endfor %}"  type="text" id="ovt_monday" name="monday_value" placeholder="0" style="border: none;" value="{{position.ovt_monday}}">
          </td>
          <td class="text-center">
            <input class="ovt_tuesday {% for item in leave.day %}{% if item == 'tuesday' %}grey-background{% endif %}{% endfor %}"  type="text" id="ovt_tuesday" name="tuesday_value" placeholder="0" style="border: none;" value="{{position.ovt_tuesday}}">
          </td>
          <td class="text-center">
            <input class="ovt_wednesday {% for item in leave.day %}{% if item == 'wednesday' %}grey-background{% endif %}{% endfor %}"  type="text" id="ovt_wednesday" name="wednesday_value" placeholder="0" style="border: none;" value="{{position.ovt_wednesday}}">
          </td>
          <td class="text-center">
            <input class="ovt_thursday {% for item in leave.day %}{% if item == 'thursday' %}grey-background{% endif %}{% endfor %}"  type="text" id="ovt_thursday" name="thursday_value" placeholder="0" style="border: none;" value="{{position.ovt_thursday}}">
          </td>
          <td class="text-center">
            <input class="ovt_friday {% for item in leave.day %}{% if item == 'friday' %}grey-background{% endif %}{% endfor %}"  type="text" id="ovt_friday" name="friday_value" placeholder="0" style="border: none;" value="{{position.ovt_friday}}">
          </td>
          <td class="text-center">
            <input class="ovt_saturday {% for item in leave.day %}{% if item == 'saturday' %}grey-background{% endif %}{% endfor %}"  type="text" id="ovt_saturday" name="saturday_value" placeholder="0" style="border: none;" value="{{position.ovt_saturday}}">
          </td>
          <td class="text-center">
            <input class="ovt_sunday {% for item in leave.day %}{% if item == 'sunday' %}grey-background{% endif %}{% endfor %}"  type="text" id="ovt_sunday" name="sunday_value" placeholder="0" style="border: none;" value="{{position.ovt_sunday}}">
          </td>
        </tr>
        
        <tr class="th_hour">
          
          <td class="text-center">
            Total Hour
          </td>
          <td class="text-center">
            <input type="text" id="th_monday" class="th_monday" name="" style="border: none;" value="{{position.th_hour_0}}"  readonly>
          </td>
          <td class="text-center">
            <input type="text" id="th_tuesday" class="th_tuesday" name="" style="border: none;" value="{{position.th_hour_1}}"  readonly>
          </td>
          <td class="text-center">
            <input type="text" id="th_wednesday" class="th_wednesday" name="" style="border: none;" value="{{position.th_hour_2}}"  readonly>
          </td>
          <td class="text-center">
            <input type="text" id="th_thursday" class="th_thursday" name="" style="border: none;" value="{{position.th_hour_3}}"  readonly>
          </td>
          <td class="text-center">
            <input type="text" id="th_friday" class="th_friday" name="" style="border: none;" value="{{position.th_hour_4}}"  readonly>
          </td>
          <td class="text-center">
            <input type="text" id="th_saturday" class="th_saturday" name="" style="border: none;" value="{{position.th_hour_5}}"  readonly>
          </td>
          <td class="text-center">
            <input type="text" id="th_sunday" class="th_sunday" name="" style="border: none;" value="{{position.th_hour_6}}"  readonly>
          </td>
        </tr>
        
        <tr style="border: transparent;">
          <td colspan="8" class="text-center" style="border: none;">&nbsp;</td>
        </tr>
        <tr class="table-secondary fw-light" id="calculationrow" style="border: transparent;">
          <td class="text-center" colspan="2">
              Standard Time: &nbsp;&nbsp;&nbsp&nbsp;
              <input type="text" id="St1" name="ST" placeholder="0"  value={{position.St}}  readonly>
          </td>
          <td class=" text-center" colspan="2">
              Over Time: &nbsp;&nbsp;&nbsp&nbsp;
              <input type="text" id="ot1" name="OT" placeholder="0" value={{position.ot}} readonly>
          </td>
          <td class="text-center" colspan="3">
              Total Time Spent: &nbsp;&nbsp;&nbsp&nbsp;
              <input type="text" id="total_hour" name="total_hour" placeholder="0" value={{position.total_hour}} readonly>
          </td>
        </tr>
        <tr id="message" style="border: transparent;">
          <td colspan="8" class="text-center">&nbsp;</td>
        </tr>
      </tbody>
      </table>
    </div>
  </div>
  <div class="row">
    <div class="">
        {% if request.user.role != "scrummaster" %}
        <button  id="submitBtn" class="btn btn-md text-light float-end" style="background-color: #4981b2">Submit</button>
        {% endif %}
    </div>
</div>
</div>
<script>
  function leave (leave) {
    console.log("inside windows.load script")
    console.log(leave)
    for( var k = 0; k<leave.length; k++ ){
      console.log('4for')
            document.querySelectorAll("."+leave[k]+"_value").forEach(element => {
              element.value = 0
              element.setAttribute('readonly', true);
              element.style.setProperty("background-color", "grey", "important"); });
              
              document.getElementById("ovt_"+leave[k]).value = 0
              document.getElementById("ovt_"+leave[k]).setAttribute('readonly', true)
              document.getElementById("ovt_"+leave[k]).style.setProperty("background-color", "grey", "important");
          }
  };
</script>
<script>
  function applyDynamicRowStyling() {
  $('input[type="text"]:not(#project_name):not(#task)').css('width', '100px');
}
</script>
<script>
// Get all input fields

// Function to show the popup
function showPopup(event) {
    const value = event.target.value;
    const popup = document.createElement('div');
    popup.classList.add('popup');
    popup.textContent = value;
    event.target.parentNode.appendChild(popup);
}

// Function to hide the popup
function hidePopup(event) {
    const popup = event.target.parentNode.querySelector('.popup');
    if (popup) {
        popup.remove();
    }
}

    $(function() {


      function calculateTotalHours() {
    var total = 0;
    var st = 0;
    var ot = 0;
    var th_mon = 0;
    var th_tue = 0;
    var th_wed = 0;
    var th_thurs = 0;
    var th_fri = 0;
    var th_sat = 0;
    var th_sun = 0;
    
    $('input[class$="_value"], input[class^="ovt_"]').each(function() {
        var value = parseFloat($(this).val()) || 0;
        total += value;
    });
    $('input[class$="_value"]').each(function() {
        var value = parseFloat($(this).val()) || 0;
        st += value;
    });
    $('input[class^="ovt_"]').each(function() {
        var value = parseFloat($(this).val()) || 0;
        console.log("value",value)
        ot += value;
    });
    $('input[class$="monday_value"], input[class^="ovt_monday"]').each(function() {
        var value = parseFloat($(this).val()) || 0;
        th_mon += value;
    });
    $('input[class$="tuesday_value"], input[class^="ovt_tuesday"]').each(function() {
        var value = parseFloat($(this).val()) || 0;
        th_tue += value;
    });
    $('input[class$="wednesday_value"], input[class^="ovt_wednesday"]').each(function() {
        var value = parseFloat($(this).val()) || 0;
        th_wed += value;
    });
    $('input[class$="thursday_value"], input[class^="ovt_thursday"]').each(function() {
        var value = parseFloat($(this).val()) || 0;
        th_thurs += value;
    });
    $('input[class$="friday_value"], input[class^="ovt_friday"]').each(function() {
        var value = parseFloat($(this).val()) || 0;
        th_fri += value;
    });
    $('input[class$="saturday_value"], input[class^="ovt_saturday"]').each(function() {
        var value = parseFloat($(this).val()) || 0;
        th_sat += value;
    });
    $('input[class$="sunday_value"], input[class^="ovt_sunday"]').each(function() {
        var value = parseFloat($(this).val()) || 0;
        th_sun += value;
    });

    console.log("ot",ot)
    $('#St1').val(st);
    document.getElementById('ot1').value = ot;
    $('#total_hour').val(total);
    $('#th_monday').val(th_mon);
    $('#th_tuesday').val(th_tue);
    $('#th_wednesday').val(th_wed);
    $('#th_thursday').val(th_thurs);
    $('#th_friday').val(th_fri);
    $('#th_saturday').val(th_sat);
    $('#th_sunday').val(th_sun);
    
}

// Trigger calculation on input change
$(document).on('input[class$="_value"], input[class^="ovt_"]').on('input', calculateTotalHours);
});
    document.getElementById("submitBtn").addEventListener("click", function(event) {
        
        function getValue(id) {
            var element = document.getElementById(id);
            if (element) {
                if (element.value !== undefined) {
                    return element.value;
                } else {
                    return element.textContent;
                }
            }
            return null;
        }

        var start_date = getValue('start_date');
        var end_date = getValue('end_date');
        var project_name = "{{position.project_name}}";
        console.log(start_date);
        var taskInputs = document.querySelectorAll('.task-input');
        var tasks = Array.from(taskInputs).map(input => input.value);
        var monday_value = Array.from(document.querySelectorAll('.monday_value')).map(input => input.value) || '0';
        var tuesday_value = Array.from(document.querySelectorAll('.tuesday_value')).map(input => input.value) || '0';
        var wednesday_value = Array.from(document.querySelectorAll('.wednesday_value')).map(input => input.value) || '0';
        var thursday_value = Array.from(document.querySelectorAll('.thursday_value')).map(input => input.value) || '0';
        var friday_value = Array.from(document.querySelectorAll('.friday_value')).map(input => input.value) || '0';
        var saturday_value = Array.from(document.querySelectorAll('.saturday_value')).map(input => input.value) || '0';
        var sunday_value = Array.from(document.querySelectorAll('.sunday_value')).map(input => input.value) || '0';
        var ovt_monday = document.getElementById('ovt_monday').value || '0';
        var ovt_tuesday = document.getElementById('ovt_tuesday').value || '0';
        var ovt_wednesday = document.getElementById('ovt_wednesday').value || '0';
        var ovt_thursday = document.getElementById('ovt_thursday').value || '0';
        var ovt_friday = document.getElementById('ovt_friday').value || '0';
        var ovt_saturday = document.getElementById('ovt_saturday').value || '0';
        var ovt_sunday = document.getElementById('ovt_sunday').value || '0';
        var St = document.getElementById('St').value || '0';
        var ot = document.getElementById('ot1').value || '0';
        var total_hour = document.getElementById('total_hour').value || '0';
        var th_hour = [
                document.getElementById('th_monday').value,
                document.getElementById('th_tuesday').value,
                document.getElementById('th_wednesday').value,
                document.getElementById('th_thursday').value,
                document.getElementById('th_friday').value,
                document.getElementById('th_saturday').value,
                document.getElementById('th_sunday').value
            ]; 

        
        // Get the form data
        //var formData = new FormData(document.getElementById("timeSheetForm"));

    // Send the form data to the server using fetch
    
    var el = $('<div>')
    el.addClass("alert alert-danger err-msg")
    el.hide()
    fetch("{% url 'view_timesheet' %}", {
                  // enter your url
        method: "POST",
        headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
        body: JSON.stringify({
                'start_date': start_date,
                'end_date': end_date,
                'project_name': project_name,
                'monday_value': monday_value,
                'tuesday_value': tuesday_value,
                'wednesday_value': wednesday_value,
                'thursday_value': thursday_value,
                'friday_value': friday_value,
                'saturday_value': saturday_value,
                'sunday_value': sunday_value,
                'th_hour': th_hour,
                'ovt_monday': ovt_monday,
                'ovt_tuesday': ovt_tuesday,
                'ovt_wednesday': ovt_wednesday,
                'ovt_thursday': ovt_thursday,
                'ovt_friday': ovt_friday,
                'ovt_saturday': ovt_saturday,
                'ovt_sunday': ovt_sunday,
                'St': St,
                'ot': ot,
                'total_hour': total_hour,
                'tasks': tasks,

            })
    })
    .then(function(response) {
        // Handle the response from the server
        if (response.ok) {
            return response.json();
        } else {
            throw new Error("Error: " + response.status);
            alert_toast("An error occured", 'error');
        }
    })

    .then(function(data) {
      if(data == "success"){
        el.removeClass("alert alert-danger err-msg")
        el.text("Success")
        el.show('slow')
      }
        // Do something with the response data
    })
    .catch(function(error) {
        // Handle any errors that occurred during the request
        console.error(error);
        alert_toast("An error occured", 'error');
    });

        

        var messageBox_submit = document.createElement("div");

        var modal = document.querySelector('#uni_modal .modal-body');
        console.log(modal)
        messageBox_submit.textContent = "Time Sheet Submitted";
        messageBox_submit.classList.add("alert", "alert-success", "small-alert");
        

        // Insert the message box at the top of the modal
        modal.insertBefore(messageBox_submit, modal.firstChild);
        // modal.appendChild(messageBox_submit);

        // Show the message box
        setTimeout(function() {
            messageBox_submit.remove();
            location.reload()
        }, 1500);
        
});

</script>


{% endblock %}