{% extends "employee_information/base.html" %} {% block pageContent %}
<style>
input[type="text"]:not(#project_name):not(#task) {
  width: 100px;
}

</style>
<style>
  .alert {
  padding: 20px;
  margin-bottom: 15px;
  border: 1px solid transparent;
  border-radius: 4px;
  position: fixed;
  text-align: center;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  width: 50%;
  z-index: 1;
}
  
  .alert-success {
      color: #3c763d;
      background-color: #dff0d8;
      border-color: #d6e9c6;
  }
  
  .alert-danger {
      color: #a94442;
      background-color: #f2dede;
      border-color: #ebccd1;
  }
  </style>
<div class="container mg-t">
  <div class="row">
    <div class="col">
      <h2 class="fw-bold mb-4">Time Sheet</h2>
      <span id="role"  style="display: none;">{{request.user.id}}</span>
    </div>
    <div id="alertdiv"></div>
  </div>
  <div class="row" style="background-color: #ecd5ef; min-height: 7%">
    
      <div class="col-lg-4 col-md-6 my-2">
        <div class="input-group">
          <label for="start_date" class="input-group-text">Start Date</label>
          <input type="date" id="start_date" class="form-control" />
        </div>
      </div>
    
    <div class="col-lg-4 col-md-6 my-2">
      <div class="input-group">
        <label for="end_date" class="input-group-text">End Date</label>
        <input type="date" id="end_date" class="form-control" />
      </div>
    </div>
    <div class="col-lg-4 col-md-6 my-2">
      <div class="input-group">
        <label for="project_name" class="input-group-text">Project Name</label>
        <input type="text" id="project_name" placeholder="Project Name / RND" class="form-control" />
      </div>
    </div>
  </div>
  <div class="row mt-5">
    <div class="table-responsive">
      <table class="table table-bordered" id="timeSheetForm">
      <thead>
        <tr class="table-secondary fw-light text-center">
          <th >Type</th>
          <th >Monday</th>
          <th >Tuesday</th>
          <th >Wednesday</th>
          <th >Thursday</th>
          <th >Friday</th>
          <th >Saturday</th>
          <th >Sunday</th>
          <th ></th>
        </tr>
      </thead>
      <tbody>
        <tr id="tasknamerow">
          
          <td class="text-center">
            <input class="text-center task-input" type="text" id="task" name="task" placeholder="Task Name">
          </td>
          <td class="text-center">
            <input class="monday_value"  type="text" id="monday_value" name="monday_value" placeholder="0" style="border: none;">
          </td>
          <td class="text-center">
            <input class="tuesday_value"  type="text" id="tuesday_value" name="tuesday_value" placeholder="0" style="border: none;">
          </td>
          <td class="text-center">
            <input class="wednesday_value"  type="text" id="wednesday_value" name="wednesday_value" placeholder="0" style="border: none;">
          </td>
          <td class="text-center">
            <input class="thursday_value"  type="text" id="thursday_value" name="thursday_value" placeholder="0" style="border: none;">
          </td>
          <td class="text-center">
            <input class="friday_value"  type="text" id="friday_value" name="friday_value" placeholder="0" style="border: none;">
          </td>
          <td class="text-center">
            <input class="saturday_value"  type="text" id="saturday_value" name="saturday_value" placeholder="0" style="border: none;">
          </td>
          <td class="text-center">
            <input class="sunday_value"  type="text" id="sunday_value" name="sunday_value" placeholder="0" style="border: none;">
          </td>
          <td class="text-center">
            <button  id="addrow">+</button>
          </td>
        </tr>
        <tr>
          
          <td class="text-center">
            Overtime Hours
          </td>
          <td class="text-center">
            <input class="ovt_monday"  type="text" id="ovt_monday" name="monday_value" placeholder="0" style="border: none;">
          </td>
          <td class="text-center">
            <input class="ovt_tuesday"  type="text" id="ovt_tuesday" name="tuesday_value" placeholder="0" style="border: none;">
          </td>
          <td class="text-center">
            <input class="ovt_wednesday"  type="text" id="ovt_wednesday" name="wednesday_value" placeholder="0" style="border: none;">
          </td>
          <td class="text-center">
            <input class="ovt_thursday"  type="text" id="ovt_thursday" name="thursday_value" placeholder="0" style="border: none;">
          </td>
          <td class="text-center">
            <input class="ovt_friday"  type="text" id="ovt_friday" name="friday_value" placeholder="0" style="border: none;">
          </td>
          <td class="text-center">
            <input class="ovt_saturday"  type="text" id="ovt_saturday" name="saturday_value" placeholder="0" style="border: none;">
          </td>
          <td class="text-center">
            <input class="ovt_sunday"  type="text" id="ovt_sunday" name="sunday_value" placeholder="0" style="border: none;">
          </td>
        </tr>
        
        <tr class="th_hour">
          
          <td class="text-center">
            Total Hour
          </td>
          <td class="text-center">
            <input type="text" id="th_monday" class="th_monday" name="" style="border: none;" value="0"  readonly>
          </td>
          <td class="text-center">
            <input type="text" id="th_tuesday" class="th_tuesday" name="" style="border: none;" value="0"  readonly>
          </td>
          <td class="text-center">
            <input type="text" id="th_wednesday" class="th_wednesday" name="" style="border: none;" value="0"  readonly>
          </td>
          <td class="text-center">
            <input type="text" id="th_thursday" class="th_thursday" name="" style="border: none;" value="0"  readonly>
          </td>
          <td class="text-center">
            <input type="text" id="th_friday" class="th_friday" name="" style="border: none;" value="0"  readonly>
          </td>
          <td class="text-center">
            <input type="text" id="th_saturday" class="th_saturday" name="" style="border: none;" value="0"  readonly>
          </td>
          <td class="text-center">
            <input type="text" id="th_sunday" class="th_sunday" name="" style="border: none;" value="0"  readonly>
          </td>
        </tr>
        
        <tr style="border: transparent;">
          <td colspan="8" class="text-center" style="border: none;">&nbsp;</td>
        </tr>
        <tr class="table-secondary fw-light" id="calculationrow" style="border: transparent;">
          <td class="text-center" colspan="2">
              Standard Time: &nbsp;&nbsp;&nbsp&nbsp;
              <input type="text" id="St" name="ST" placeholder="0" value="0"  readonly>
          </td>
          <td class=" text-center" colspan="2">
              Over Time: &nbsp;&nbsp;&nbsp&nbsp;
              <input type="text" id="ot" name="ST" placeholder="0" value="0"  readonly>
          </td>
          <td class="text-center" colspan="3">
              Total Time Spent: &nbsp;&nbsp;&nbsp&nbsp;
              <input type="text" id="total_hour" name="total_hour" placeholder="0" value="0" readonly>
          </td>
        </tr>
        <tr id="message" style="border: transparent;">
          <td colspan="8" class="text-center">&nbsp;</td>
        </tr>
      </tbody>
      </table>
    </div>
  </div>
  <div class="row">
    <div class="">
        <button  id="saveBtn" class="btn btn-md text-light btn-success mx-1 float-start" >Save</button>
        <button  id="discardBtn" class="btn btn-md text-light btn-danger mx-1 float-start" style="background-color: #b24949; margin-left: 2px;" >Discard</button>
        <button  id="submitBtn" class="btn btn-md text-light btn-color float-end" style="background-color: #4981b2;">Submit</button>
    </div>
</div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>
  
  function applyDynamicRowStyling() {
  $('input[type="text"]:not(#project_name):not(#task)').css('width', '100px');
  console.log("dynamic")
}
  // Creating the warning msg
  var messageBox1 = document.createElement("div");
                    messageBox1.textContent = "* You have already Submitted the Time Sheet *";
                    messageBox1.classList.add("message1-box");
                    //document.body.appendChild(messageBox1);
                    // Get the parent element of the total hour input field
                    
                    var messageCell = document.getElementById("message").children[0];

                    // Append the message box to the table cell
                    messageCell.appendChild(messageBox1);
  // date change, check to see if there is data for that date
  messageBox1.style.display = "none";
  function getPreviousMonday() {
    var date = new Date();
    var day = date.getUTCDay();
    var currentWeekMonday;

    if(day === 0){ // If it's Sunday
        currentWeekMonday = new Date(date.getTime() - 6 * 24 * 60 * 60 * 1000);
    }
    else{
        currentWeekMonday = new Date(date.getTime() - (day - 1) * 24 * 60 * 60 * 1000);
    }

    return currentWeekMonday;
}

    $(function() {
      console.log("inside apply dynamic script")
            var previousMonday = getPreviousMonday();
        var formattedDate = previousMonday.toISOString().split('T')[0];
        $('#start_date').val(formattedDate);
        var startDate = new Date(formattedDate);
        var endDate = new Date(startDate.getTime() + (6 * 24 * 60 * 60 * 1000)); // Add 6 days to start date
        var formattedEndDate = endDate.toISOString().split('T')[0]; // Format the end date as YYYY-MM-DD
        $('#end_date').val(formattedEndDate);

        document.getElementById('start_date').addEventListener('change', function() {
            
            var startDate = new Date(this.value);
            var day = startDate.getDay();
            var diff = startDate.getDate() - day + (day === 0 ? -6 : 1); // Calculate the difference to the previous Monday
            var mondayDate = new Date(startDate.setDate(diff));
            var formattedStartDate = mondayDate.toISOString().split('T')[0];
            var endDate = new Date(mondayDate.getTime() + (6 * 24 * 60 * 60 * 1000)); // Add 6 days to start date
            var formattedEndDate = endDate.toISOString().split('T')[0]; // Format the end date as YYYY-MM-DD
            document.getElementById('end_date').value = formattedEndDate;
            document.getElementById('start_date').value = formattedStartDate;
            var formattedStartDate = startDate.toISOString().split('T')[0];
            var formattedEndDate = endDate.toISOString().split('T')[0];
            var username = document.body.getAttribute('data-username');
            

            


            fetch("{% url 'timesheets_create' %}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({
                'start_date': formattedStartDate,
                'end_date': formattedEndDate,
                'username':username,
                'method_1': "first_fetch"
            })
        })
        .then(response => response.json())
        .then(data => {
          console.log("first script")
          if (!data) {
            console.log("first script reload")
            location.reload();}
            
                // data is not empty, create HTML elements to display the data
                let table = document.getElementById('yourTableId')
                
                applyDynamicRowStyling()
                document.getElementById("project_name").value = data?.project_name || '';
                document.getElementById("monday_value").value = data?.monday_value || '0';
                document.getElementById("tuesday_value").value = data?.tuesday_value || '0';
                document.getElementById("wednesday_value").value = data?.wednesday_value || '0';
                document.getElementById("thursday_value").value = data?.thursday_value || '0';
                document.getElementById("friday_value").value = data?.friday_value || '0';
                document.getElementById("saturday_value").value = data?.saturday_value || '0';
                document.getElementById("sunday_value").value = data?.sunday_value || '0';
                document.getElementById("ovt_monday").value = data?.ovt_monday || '0';
                document.getElementById("ovt_tuesday").value = data?.ovt_tuesday || '0';
                document.getElementById("ovt_wednesday").value = data?.ovt_wednesday || '0';
                document.getElementById("ovt_thursday").value = data?.ovt_thursday || '0';
                document.getElementById("ovt_friday").value = data?.ovt_friday || '0';
                document.getElementById("ovt_saturday").value = data?.ovt_saturday || '0';
                document.getElementById("ovt_sunday").value = data?.ovt_sunday || '0';
                document.getElementById("St").value = data?.St || '0';
                document.getElementById("ot").value = data?.ot || '0';
                document.getElementById("total_hour").value = data?.total_hour || '0';
                document.getElementById("th_monday").value = data?.th_hour[0] || '0';
                document.getElementById("th_tuesday").value = data?.th_hour[1] || '0';
                document.getElementById("th_wednesday").value = data?.th_hour[2] || '0';
                document.getElementById("th_thursday").value = data?.th_hour[3] || '0';
                document.getElementById("th_friday").value = data?.th_hour[4] || '0';
                document.getElementById("th_saturday").value = data?.th_hour[5] || '0';
                document.getElementById("th_sunday").value = data?.th_hour[6] || '0';

                if (data.monday_value.length <= 1) {
                  console.log('321321')
                    document.getElementById("task").value = data?.tasks[0] || '';
                    document.getElementById("monday_value").value = data?.monday_value[0] || '0';
                    document.getElementById("tuesday_value").value = data?.tuesday_value[0] || '0';
                    document.getElementById("wednesday_value").value = data?.wednesday_value[0] || '0';
                    document.getElementById("thursday_value").value = data?.thursday_value[0] || '0';
                    document.getElementById("friday_value").value = data?.friday_value[0] || '0';
                    document.getElementById("saturday_value").value = data?.saturday_value[0] || '0';
                    document.getElementById("sunday_value").value = data?.sunday_value[0] || '0';

                }
                else{
                  console.log('321321')
                    document.getElementById("task").value = data?.tasks[0] || '';
                    document.getElementById("monday_value").value = data?.monday_value[0] || '0';
                    document.getElementById("tuesday_value").value = data?.tuesday_value[0] || '0';
                    document.getElementById("wednesday_value").value = data?.wednesday_value[0] || '0';
                    document.getElementById("thursday_value").value = data?.thursday_value[0] || '0';
                    document.getElementById("friday_value").value = data?.friday_value[0] || '0';
                    document.getElementById("saturday_value").value = data?.saturday_value[0] || '0';
                    document.getElementById("sunday_value").value = data?.sunday_value[0] || '0';
                    
                    var totallength = (data.monday_value.length) 
                    console.log('error here1')
                    var tbody = document.getElementsByTagName('table')[0].getElementsByTagName('tbody')[0];
                    var rows_remove = document.getElementsByClassName("newRow");
                    while(rows_remove[0]) {
                      rows_remove[0].parentNode.removeChild(rows_remove[0]);
                    }
                    console.log('error here41')
                    var rows = tbody.getElementsByTagName("tr");
                    var taskNameRow = rows[rows.length - 5];
                    console.log("data new row123")
                    
                    for (var i = 1; i <= totallength-1; i++) {
                      console.log(i, totallength-1 )
                        var newRow = document.createElement("tr");
                        newRow.className = "newRow";  // Assign a class to the row
                                            
                        newRow.innerHTML += `
                        <td class="text-center">
                          <input class="text-center task-input" type="text" id="task" name="task" placeholder="Task Name" value="${data.tasks[i] || 0}">
                        </td>
                        <td class="text-center">
                          <input class="monday_value"  type="text" id="monday_value" name="monday_value" placeholder="0" style="border: none;" value="${data.monday_value[i] || 0}">
                        </td>
                        <td class="text-center">
                          <input class="tuesday_value"  type="text" id="tuesday_value" name="tuesday_value" placeholder="0" style="border: none;" value="${data.tuesday_value[i] || 0}">
                        </td>
                        <td class="text-center">
                          <input class="wednesday_value"  type="text" id="wednesday_value" name="wednesday_value" placeholder="0" style="border: none;" value="${data.wednesday_value[i] || 0}">
                        </td>
                        <td class="text-center">
                          <input class="thursday_value"  type="text" id="thursday_value" name="thursday_value" placeholder="0" style="border: none;" value="${data.thursday_value[i] || 0}">
                        </td>
                        <td class="text-center">
                          <input class="friday_value"  type="text" id="friday_value" name="friday_value" placeholder="0" style="border: none;" value="${data.friday_value[i] || 0}">
                        </td>
                        <td class="text-center">
                          <input class="saturday_value"  type="text" id="saturday_value" name="saturday_value" placeholder="0" style="border: none;" value="${data.saturday_value[i] || 0}">
                        </td>
                        <td class="text-center">
                          <input class="sunday_value"  type="text" id="sunday_value" name="sunday_value" placeholder="0" style="border: none;" value="${data.sunday_value[i] || 0}">
                        </td>       
                        `;
                        taskNameRow.parentNode.insertBefore(newRow, taskNameRow);
                    }console.log("dont")}
                
                
                
                if (data?.status!="uncheck" ) {
                  console.log('here1')
                    messageBox1.style.display = "block"; // Show the message box
                    
                    // Removing buttons
                    document.getElementById("submitBtn").style.display = "none";
                    document.getElementById("discardBtn").style.display = "none";
                    document.getElementById("saveBtn").style.display = "none";
                    
                    // Making inputs read-only
                    document.getElementById("project_name").readOnly = true;
                    document.getElementById("monday_value").readOnly = true;
                    document.getElementById("tuesday_value").readOnly = true;
                    document.getElementById("wednesday_value").readOnly = true;
                    document.getElementById("thursday_value").readOnly = true;
                    document.getElementById("friday_value").readOnly = true;
                    document.getElementById("saturday_value").readOnly = true;
                    document.getElementById("sunday_value").readOnly = true;
                    document.getElementById("ovt_monday").readOnly = true;
                    document.getElementById("ovt_tuesday").readOnly = true;
                    document.getElementById("ovt_wednesday").readOnly = true;
                    document.getElementById("ovt_thursday").readOnly = true;
                    document.getElementById("ovt_friday").readOnly = true;
                    document.getElementById("ovt_saturday").readOnly = true;
                    document.getElementById("ovt_sunday").readOnly = true;
                    document.getElementById("St").readOnly = true;
                    document.getElementById("ot").readOnly = true;
                    document.getElementById("total_hour").readOnly = true;

                    

                }
                else{
                      messageBox1.style.display = "none"; // Hide the message box
                      console.log("here1.1")
                      document.getElementById("submitBtn").style.display = "block";
                      document.getElementById("discardBtn").style.display = "block";
                      document.getElementById("saveBtn").style.display = "block";

                      // Making inputs read-only
                    document.getElementById("project_name").readOnly = false;
                    document.getElementById("monday_value").readOnly = false;
                    document.getElementById("tuesday_value").readOnly = false;
                    document.getElementById("wednesday_value").readOnly = false;
                    document.getElementById("thursday_value").readOnly = false;
                    document.getElementById("friday_value").readOnly = false;
                    document.getElementById("saturday_value").readOnly = false;
                    document.getElementById("sunday_value").readOnly = false;
                    document.getElementById("ovt_monday").readOnly = false;
                    document.getElementById("ovt_tuesday").readOnly = false;
                    document.getElementById("ovt_wednesday").readOnly = false;
                    document.getElementById("ovt_thursday").readOnly = false;
                    document.getElementById("ovt_friday").readOnly = false;
                    document.getElementById("ovt_saturday").readOnly = false;
                    document.getElementById("ovt_sunday").readOnly = false;
                    document.getElementById("St").readOnly = false;
                    document.getElementById("ot").readOnly = false;
                    document.getElementById("total_hour").readOnly = false;
                    }
                if (!data.leave_date){
                  console.log("here1.2")
                  
                  id5 = ["monday_value", "tuesday_value", "wednesday_value", "thursday_value", "friday_value"]
                  id6 = ["ovt_monday", "ovt_tuesday", "ovt_wednesday", "ovt_thursday", "ovt_friday"]
                  for (i=0; i <= id5.length; i++){
                  var leave_input = document.querySelectorAll('.'+id5[i]);
                  leave_input.forEach((input) => {
                        input.style.backgroundColor = "transparent";
                        input.readOnly = false;
                    });
                    var leave_input1 = document.querySelectorAll('.'+id6[i]);
                  leave_input1.forEach((input) => {
                        input.style.backgroundColor = "transparent";
                        input.readOnly = false;
                    });
                  }
                }
                else {
                  
                      // Define an array of IDs of the input fields
    var dayIds = ['monday_value', 'tuesday_value', 'wednesday_value', 'thursday_value', 'friday_value', 'saturday_value','sunday_value'];
    let days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
    var ovtIds = ['ovt_monday', 'ovt_tuesday', 'ovt_wednesday', 'ovt_thursday', 'ovt_friday', 'ovt_saturday', 'ovt_sunday'];
    
    
    
    console.log("first")
    console.log(data)
    for( var k = 0; k<=data["leave_date"].length; k++ ){
      
      
      
      
    if (data["leave_date"][k].status == "Approved") {
      
      for (var i = 0; i <= 0; i++) {
        var startdate = data["leave_date"][k].start_date
        var enddate = data["leave_date"][k].end_date
        

        // Get the start date and end date from the table fields
        var startDateField = document.getElementById('start_date').value;
        var startDateField = new Date(startDateField);
        var endDateField = document.getElementById('end_date').value;
        var endDateField = new Date(endDateField);

        var startdate = new Date(startdate);
        var enddate = new Date(enddate);
        
        
        

        if (startDateField <= startdate && startDateField <= enddate) {
          console.log("first1.1")
          // total_days = startdate - enddate;
          var total_days = Math.round((enddate - startdate) / (1000 * 60 * 60 * 24));
          
          var starting_date = Math.round((startdate - startDateField) / (1000 * 60 * 60 * 24));
          console.log("starting date", starting_date)
          
          for(let i = 0; i < days.length; i++) {

          let inputElements = document.querySelectorAll('.'+days[i]+'_value');

          inputElements.forEach(inputElement => {
              let color = window.getComputedStyle(inputElement).getPropertyValue('background-color');
              if (color == 'rgb(128, 128, 128)') {
                
                  inputElement.style.backgroundColor = 'transparent';
                  inputElement.ariaPlaceholder = '0';
                  inputElement.readOnly = false;
              }
          });
          let inputElements4 = document.querySelectorAll('.ovt_'+days[i]);
          inputElements4.forEach(inputElement => {
              let color = window.getComputedStyle(inputElement).getPropertyValue('background-color');
              if (color == 'rgb(128, 128, 128)') {
                
                  inputElement.style.backgroundColor = 'transparent';
                  inputElement.ariaPlaceholder = '0';
                  inputElement.readOnly = false;
              }
          });
          }


          if (total_days == 0){
            console.log("first1.3")
            
            
            var dayId = dayIds[starting_date];
            var ovtId = ovtIds[starting_date];
            document.querySelectorAll("."+dayId).forEach(element => {
              element.value = 0
              element.setAttribute('readonly', true);
              element.style.setProperty("background-color", "grey", "important"); });
              
              document.getElementById(ovtId).value = 0
              document.getElementById(ovtId).setAttribute('readonly', true)
              document.getElementById(ovtId).style.setProperty("background-color", "grey", "important");
          }
          else{
            
            let days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            console.log("first1.2")
            for(let i = 0; i < days.length; i++) {

                let inputElements = document.querySelectorAll('.'+days[i]+'_value');
                
                inputElements.forEach(inputElement => {
                    let color = window.getComputedStyle(inputElement).getPropertyValue('background-color');
                    if (color == 'rgb(128, 128, 128)') {
                      
                        inputElement.style.backgroundColor = 'transparent';
                        inputElement.ariaPlaceholder = '0';
                        inputElement.readOnly = false;
                    }
                });
                let inputElements4 = document.querySelectorAll('.ovt_'+days[i]);
                inputElements4.forEach(inputElement => {
                    let color = window.getComputedStyle(inputElement).getPropertyValue('background-color');
                    if (color == 'rgb(128, 128, 128)') {
                      
                        inputElement.style.backgroundColor = 'transparent';
                        inputElement.ariaPlaceholder = '0';
                        inputElement.readOnly = false;
                    }
                });
            }
            for (var i = starting_date; total_days>= 0; i++){
              
              
              var dayId = dayIds[i];
              var ovtId = ovtIds[i];
              
              
              document.querySelectorAll("."+dayId).forEach(element => {
              element.value = 0
              element.setAttribute('readonly', true);
              element.style.setProperty("background-color", "grey", "important"); });

            
              document.getElementById(ovtId).value = 0
              document.getElementById(ovtId).setAttribute('readonly', true)
              document.getElementById(ovtId).style.setProperty("background-color", "grey", "important");
              total_days--;
            }
        }
        }
        else{
          
        }



        
      }
        
      if (data?.project_name && data?.status!="uncheck") {
                    messageBox1.style.display = "block"; // Show the message box
                    // Removing buttons
                    document.getElementById("submitBtn").style.display = "none";
                    document.getElementById("discardBtn").style.display = "none";
                    document.getElementById("saveBtn").style.display = "none";
                    
                    // Making inputs read-only
                    document.getElementById("project_name").readOnly = true;
                    document.getElementById("monday_value").readOnly = true;
                    document.getElementById("tuesday_value").readOnly = true;
                    document.getElementById("wednesday_value").readOnly = true;
                    document.getElementById("thursday_value").readOnly = true;
                    document.getElementById("friday_value").readOnly = true;
                    document.getElementById("saturday_value").readOnly = true;
                    document.getElementById("sunday_value").readOnly = true;
                    document.getElementById("ovt_monday").readOnly = true;
                    document.getElementById("ovt_tuesday").readOnly = true;
                    document.getElementById("ovt_wednesday").readOnly = true;
                    document.getElementById("ovt_thursday").readOnly = true;
                    document.getElementById("ovt_friday").readOnly = true;
                    document.getElementById("ovt_saturday").readOnly = true;
                    document.getElementById("ovt_sunday").readOnly = true;
                    document.getElementById("St").readOnly = true;
                    document.getElementById("ot").readOnly = true;
                    document.getElementById("total_hour").readOnly = true;

                    

                }
    else{
      messageBox1.style.display = "none"; // Hide the message box
                      document.getElementById("submitBtn").style.display = "block";
                      document.getElementById("discardBtn").style.display = "block";
                      document.getElementById("saveBtn").style.display = "block";

                      // Making inputs read-only
                    document.getElementById("project_name").readOnly = false;
                    document.getElementById("monday_value").readOnly = false;
                    document.getElementById("tuesday_value").readOnly = false;
                    document.getElementById("wednesday_value").readOnly = false;
                    document.getElementById("thursday_value").readOnly = false;
                    document.getElementById("friday_value").readOnly = false;
                    document.getElementById("saturday_value").readOnly = false;
                    document.getElementById("sunday_value").readOnly = false;
                    document.getElementById("ovt_monday").readOnly = false;
                    document.getElementById("ovt_tuesday").readOnly = false;
                    document.getElementById("ovt_wednesday").readOnly = false;
                    document.getElementById("ovt_thursday").readOnly = false;
                    document.getElementById("ovt_friday").readOnly = false;
                    document.getElementById("ovt_saturday").readOnly = false;
                    document.getElementById("ovt_sunday").readOnly = false;
                    document.getElementById("St").readOnly = false;
                    document.getElementById("ot").readOnly = false;
                    document.getElementById("total_hour").readOnly = false;
    }
       
    }}
                }
                if (data.status!="uncheck") {
                  console.log("first1.2")
                    messageBox1.style.display = "block"; // Show the message box
                    
                    // Removing buttons
                    document.getElementById("submitBtn").style.display = "none";
                    document.getElementById("discardBtn").style.display = "none";
                    document.getElementById("saveBtn").style.display = "none";
                    
                    // Making inputs read-only
                    document.getElementById("project_name").readOnly = true;
                    document.getElementById("monday_value").readOnly = true;
                    document.getElementById("tuesday_value").readOnly = true;
                    document.getElementById("wednesday_value").readOnly = true;
                    document.getElementById("thursday_value").readOnly = true;
                    document.getElementById("friday_value").readOnly = true;
                    document.getElementById("saturday_value").readOnly = true;
                    document.getElementById("sunday_value").readOnly = true;
                    document.getElementById("ovt_monday").readOnly = true;
                    document.getElementById("ovt_tuesday").readOnly = true;
                    document.getElementById("ovt_wednesday").readOnly = true;
                    document.getElementById("ovt_thursday").readOnly = true;
                    document.getElementById("ovt_friday").readOnly = true;
                    document.getElementById("ovt_saturday").readOnly = true;
                    document.getElementById("ovt_sunday").readOnly = true;
                    document.getElementById("St").readOnly = true;
                    document.getElementById("ot").readOnly = true;
                    document.getElementById("total_hour").readOnly = true;

                    

                }
                else{
                  if (!data.leave_date){
                  
                  id5 = ["monday_value", "tuesday_value", "wednesday_value", "thursday_value", "friday_value"]
                  id6 = ["ovt_monday", "ovt_tuesday", "ovt_wednesday", "ovt_thursday", "ovt_friday"]
                  for (i=0; i <= id5.length; i++){
                  var leave_input = document.querySelectorAll('.'+i[id5]);
                  leave_input.forEach((input) => {
                        input.style.backgroundColor = "transparent";
                        input.readOnly = false;
                    });
                    var leave_input1 = document.querySelectorAll('.'+i[id6]);
                  leave_input1.forEach((input) => {
                        input.style.backgroundColor = "transparent";
                        input.readOnly = false;
                    });
                  }
                }
                else {
                  console.log('else', data)
                      // Define an array of IDs of the input fields
    var dayIds = ['monday_value', 'tuesday_value', 'wednesday_value', 'thursday_value', 'friday_value', 'saturday_value','sunday_value'];
    
    var ovtIds = ['ovt_monday', 'ovt_tuesday', 'ovt_wednesday', 'ovt_thursday', 'ovt_friday', 'ovt_saturday', 'ovt_sunday'];
    
    
    
    for( var k = 0; k<=data["leave_date"].length; k++ ){
      
      
      
      
    if (data["leave_date"][k].status == "Approved") {
      
      for (var i = 0; i <= 0; i++) {
        var startdate = data["leave_date"][k].start_date
        var enddate = data["leave_date"][k].end_date
        

        // Get the start date and end date from the table fields
        var startDateField = document.getElementById('start_date').value;
        var startDateField = new Date(startDateField);
        var endDateField = document.getElementById('end_date').value;
        var endDateField = new Date(endDateField);

        var startdate = new Date(startdate);
        var enddate = new Date(enddate);
        
        
        

        if (startDateField <= startdate && startDateField <= enddate) {
          
          // total_days = startdate - enddate;
          var total_days = Math.round((enddate - startdate) / (1000 * 60 * 60 * 24));
          
          var starting_date = Math.round((startdate - startDateField) / (1000 * 60 * 60 * 24));
          
          if (total_days == 0){
            
            var dayId = dayIds[starting_date];
            var ovtId = ovtIds[starting_date];
            document.querySelectorAll("."+dayId).forEach(element => {
              element.value = 0
              element.setAttribute('readonly', true);
              element.style.setProperty("background-color", "grey", "important"); });
              
              document.getElementById(ovtId).value = 0
              document.getElementById(ovtId).setAttribute('readonly', true)
              document.getElementById(ovtId).style.setProperty("background-color", "grey", "important");
          }
          else{
            
            for (var i = starting_date; total_days>= 0; i++){
              
              
              var dayId = dayIds[i];
              var ovtId = ovtIds[i];
              
              
              document.querySelectorAll("."+dayId).forEach(element => {
              element.value = 0
              element.setAttribute('readonly', true);
              element.style.setProperty("background-color", "grey", "important"); });

            
              document.getElementById(ovtId).value = 0
              document.getElementById(ovtId).setAttribute('readonly', true)
              document.getElementById(ovtId).style.setProperty("background-color", "grey", "important");
              total_days--;
            }
        }
        }
        else{
          
        }


        if (data?.status!="uncheck"){
                    
                    
                    location.reload();}

                    else{
                      messageBox1.style.display = "none"; // Hide the message box
                      document.getElementById("submitBtn").style.display = "block";
                      document.getElementById("discardBtn").style.display = "block";
                      document.getElementById("saveBtn").style.display = "block";

                      // Making inputs read-only
                    document.getElementById("project_name").readOnly = false;
                    document.getElementById("monday_value").readOnly = false;
                    document.getElementById("tuesday_value").readOnly = false;
                    document.getElementById("wednesday_value").readOnly = false;
                    document.getElementById("thursday_value").readOnly = false;
                    document.getElementById("friday_value").readOnly = false;
                    document.getElementById("saturday_value").readOnly = false;
                    document.getElementById("sunday_value").readOnly = false;
                    document.getElementById("ovt_monday").readOnly = false;
                    document.getElementById("ovt_tuesday").readOnly = false;
                    document.getElementById("ovt_wednesday").readOnly = false;
                    document.getElementById("ovt_thursday").readOnly = false;
                    document.getElementById("ovt_friday").readOnly = false;
                    document.getElementById("ovt_saturday").readOnly = false;
                    document.getElementById("ovt_sunday").readOnly = false;
                    document.getElementById("St").readOnly = false;
                    document.getElementById("ot").readOnly = false;
                    document.getElementById("total_hour").readOnly = false;
                    }
                                }
        
      }
        

       
    }}
                }
                  
                    
                            

                    // fetch("{% url 'timesheets_create' %}", {
                    //     method: 'GET', // or 'POST', 'PUT', 'DELETE', etc. depending on your API
                    //     headers: {
                    //         'Content-Type': 'application/json', // set the appropriate content type
                    //         'X-CSRFToken': '{{ csrf_token }}'
                    //     },
                    //     // add a request body if required
                    //     })
                    
                    
            });
          
        });
      

        
        var data1 = localStorage.getItem('tableData');         
        var formattedStartDate = startDate.toISOString().split('T')[0];
        var formattedEndDate = endDate.toISOString().split('T')[0];
        fetch("{% url 'timesheets_create' %}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({
                'start_date': formattedStartDate,
                'end_date': formattedEndDate,
                'method_1': "first_fetch"
            })
        })
        .then(response => response.json())
        .then(data => {
            console.log('345')
            if(data1){
              var table_value = JSON.parse(data1);
              var current_role = document.getElementById('role').textContent;
              console.log('3456')
              if (table_value.role == current_role && start_date != table_value.start_date){
                console.log('34567')
                data1=null;
              }
            }
            if (data) {
              console.log("844")
              
            }
            else if(data1) {
              console.log('here')
              // Check if there is any saved table data in local storage

        var savedTableData = localStorage.getItem('tableData');
        var taskInputs = localStorage.getItem('taskInputs')
        
        var role = document.getElementById('role').textContent;
        var role_checking = JSON.parse(savedTableData);
        
        console.log('1')
        if (savedTableData && role_checking.start_date != formattedStartDate){
          savedTableData = null;
          taskInputs = null;
        }

        if (savedTableData && role_checking.role != role){
          console.log("true")
                  savedTableData = null;
                  taskInputs = null;
                }
        
        
        if (savedTableData) {
          console.log('saved')
            // Parse the saved table data
            var tableData = JSON.parse(savedTableData);
            
            applyDynamicRowStyling()
            

            // Populate the table with the saved data
            document.getElementById('project_name').value = tableData["project_name"];
            document.getElementById('start_date').value = tableData.start_date;
            document.getElementById('end_date').value = tableData.end_date;
            
            
            document.getElementById('ovt_monday').value = tableData.ovt_monday;
            document.getElementById('ovt_tuesday').value = tableData.ovt_tuesday;
            document.getElementById('ovt_wednesday').value = tableData.ovt_wednesday;
            document.getElementById('ovt_thursday').value = tableData.ovt_thursday;
            document.getElementById('ovt_friday').value = tableData.ovt_friday;
            document.getElementById('ovt_saturday').value = tableData.ovt_saturday;
            document.getElementById('ovt_sunday').value = tableData.ovt_sunday;
            document.getElementById('St').value = tableData.St;
            document.getElementById('ot').value = tableData.ot;
            document.getElementById('total_hour').value = tableData.total_hour;

            document.getElementById('th_monday').value = tableData.th_hour[0];
            document.getElementById('th_tuesday').value = tableData.th_hour[1];
            document.getElementById('th_wednesday').value = tableData.th_hour[2];
            document.getElementById('th_thursday').value = tableData.th_hour[3];
            document.getElementById('th_friday').value = tableData.th_hour[4];
            document.getElementById('th_saturday').value = tableData.th_hour[5];
            document.getElementById('th_sunday').value = tableData.th_hour[6];

            var data5 = JSON.parse(localStorage.getItem('taskInputs'));
            
            if (data5.monday_value.length <= 1) {
              console.log("data new row 2")
              
                        document.getElementById("task").value = data5?.tasks[0] || '';
                        document.getElementById("monday_value").value = data5?.monday_value[0] || '';
                        document.getElementById("tuesday_value").value = data5?.tuesday_value[0] || '';
                        document.getElementById("wednesday_value").value = data5?.wednesday_value[0] || '';
                        document.getElementById("thursday_value").value = data5?.thursday_value[0] || '';
                        document.getElementById("friday_value").value = data5?.friday_value[0] || '';
                        document.getElementById("saturday_value").value = data5?.saturday_value[0] || '';
                        document.getElementById("sunday_value").value = data5?.sunday_value[0] || '';

            }
            else{
              
                        document.getElementById("task").value = data5?.tasks[0] || '';
                        document.getElementById("monday_value").value = data5?.monday_value[0] || '';
                        document.getElementById("tuesday_value").value = data5?.tuesday_value[0] || '';
                        document.getElementById("wednesday_value").value = data5?.wednesday_value[0] || '';
                        document.getElementById("thursday_value").value = data5?.thursday_value[0] || '';
                        document.getElementById("friday_value").value = data5?.friday_value[0] || '';
                        document.getElementById("saturday_value").value = data5?.saturday_value[0] || '';
                        document.getElementById("sunday_value").value = data5?.sunday_value[0] || '';
                        var totallength = (data5.monday_value.length) 
                        
                        var rows_remove = document.getElementsByClassName("newRow");
                        while(rows_remove[0]) {
                            rows_remove[0].parentNode.removeChild(rows_remove[0]);
                        }
                        console.log('error here42')
                        var rows = tbody.getElementsByTagName("tr");
                        console.log("error here 42.1")
                        var taskNameRow = rows[rows.length - 5];
                        console.log("data new row 1")
                        
                        for (var i = 1; i <= totallength-1; i++) {
                          
                            var newRow = document.createElement("tr");
                            newRow.className = "newRow";
                                                  
                            newRow.innerHTML += `
                            
                            
                            <td class="text-center">
                                  <input class="text-center task-input"  type="text" id="task" name="task" placeholder="Task Name" value="${data5.tasks[i] || 0}">
                                </td>
                                <td class="text-center">
                                  <input class="monday_value"  type="text" id="monday_value" name="monday_value" placeholder="0" style="border: none;" value="${data5.monday_value[i] || 0}">
                                </td>
                                <td class="text-center">
                                  <input class="tuesday_value"  type="text" id="tuesday_value" name="tuesday_value" placeholder="0" style="border: none;" value="${data5.tuesday_value[i] || 0}">
                                </td>
                                <td class="text-center">
                                  <input class="wednesday_value"  type="text" id="wednesday_value" name="wednesday_value" placeholder="0" style="border: none;" value="${data5.wednesday_value[i] || 0}">
                                </td>
                                <td class="text-center">
                                  <input class="thursday_value"  type="text" id="thursday_value" name="thursday_value" placeholder="0" style="border: none;" value="${data5.thursday_value[i] || 0}">
                                </td>
                                <td class="text-center">
                                  <input class="friday_value"  type="text" id="friday_value" name="friday_value" placeholder="0" style="border: none;" value="${data5.friday_value[i] || 0}">
                                </td>
                                <td class="text-center">
                                  <input class="saturday_value"  type="text" id="saturday_value" name="saturday_value" placeholder="0" style="border: none;" value="${data5.saturday_value[i] || 0}">
                                </td>
                                <td class="text-center">
                                  <input class="sunday_value"  type="text" id="sunday_value" name="sunday_value" placeholder="0" style="border: none;" value="${data5.sunday_value[i] || 0}">
                                </td>
                            `;
                            taskNameRow.parentNode.insertBefore(newRow, taskNameRow);
                        }
                        
            }
            
            
        }
        
            }
            
            else{
              console.log("here23")
            }
            if (data && data.monday_value ) {
            console.log('here233')
                
                // data is not empty, create HTML elements to display the data
                let table = document.getElementById('yourTableId')
                applyDynamicRowStyling()
                document.getElementById("project_name").value = data?.project_name || '';
                document.getElementById("monday_value").value = data?.monday_value || '0';
                document.getElementById("tuesday_value").value = data?.tuesday_value || '0';
                document.getElementById("wednesday_value").value = data?.wednesday_value || '0';
                document.getElementById("thursday_value").value = data?.thursday_value || '0';
                document.getElementById("friday_value").value = data?.friday_value || '0';
                document.getElementById("saturday_value").value = data?.saturday_value || '0';
                document.getElementById("sunday_value").value = data?.sunday_value || '0';
                document.getElementById("ovt_monday").value = data?.ovt_monday || '0';
                document.getElementById("ovt_tuesday").value = data?.ovt_tuesday || '0';
                document.getElementById("ovt_wednesday").value = data?.ovt_wednesday || '0';
                document.getElementById("ovt_thursday").value = data?.ovt_thursday || '0';
                document.getElementById("ovt_friday").value = data?.ovt_friday || '0';
                document.getElementById("ovt_saturday").value = data?.ovt_saturday || '0';
                document.getElementById("ovt_sunday").value = data?.ovt_sunday || '0';
                document.getElementById("St").value = data?.St || '0';
                document.getElementById("ot").value = data?.ot || '0';
                document.getElementById("total_hour").value = data?.total_hour || '0';
                document.getElementById("th_monday").value = data?.th_hour[0] || '0';
                document.getElementById("th_tuesday").value = data?.th_hour[1] || '0';
                document.getElementById("th_wednesday").value = data?.th_hour[2] || '0';
                document.getElementById("th_thursday").value = data?.th_hour[3] || '0';
                document.getElementById("th_friday").value = data?.th_hour[4] || '0';
                document.getElementById("th_saturday").value = data?.th_hour[5] || '0';
                document.getElementById("th_sunday").value = data?.th_hour[6] || '0';

                
                
                
                if (data.monday_value.length <= 1) {
                  console.log('123123123')
                    document.getElementById("task").value = data?.tasks[0] || '0';
                    
                    document.getElementById("monday_value").value = data?.monday_value[0] || '0';
                    document.getElementById("tuesday_value").value = data?.tuesday_value[0] || '0';
                    document.getElementById("wednesday_value").value = data?.wednesday_value[0] || '0';
                    document.getElementById("thursday_value").value = data?.thursday_value[0] || '0';
                    document.getElementById("friday_value").value = data?.friday_value[0] || '0';
                    document.getElementById("saturday_value").value = data?.saturday_value[0] || '0';
                    document.getElementById("sunday_value").value = data?.sunday_value[0] || '0';

                }
                else{
                  console.log('321321')
                    document.getElementById("task").value = data?.tasks[0] || '0';
                    document.getElementById("monday_value").value = data?.monday_value[0] || '0';
                    document.getElementById("tuesday_value").value = data?.tuesday_value[0] || '0';
                    document.getElementById("wednesday_value").value = data?.wednesday_value[0] || '0';
                    document.getElementById("thursday_value").value = data?.thursday_value[0] || '0';
                    document.getElementById("friday_value").value = data?.friday_value[0] || '0';
                    document.getElementById("saturday_value").value = data?.saturday_value[0] || '0';
                    document.getElementById("sunday_value").value = data?.sunday_value[0] || '0';
                    var totallength = (data.monday_value.length) 
                    console.log('error here2')
                    var tbody = document.getElementsByTagName('table')[0].getElementsByTagName('tbody')[0];
                    var rows = tbody.getElementsByTagName("tr");
                    var taskNameRow = rows[rows.length - 5];
                    //////////////////////////////////
                    console.log("vanten")
                    

                    /////////////////////////////////
                    for (var i = 1; i <= totallength-1; i++) {
                        var newRow = document.createElement("tr");
                        newRow.className = "newRow";
                                              
                        newRow.innerHTML += `
                        <td class="text-center">
                          <input class="text-center task-input" type="text" id="task" name="task" placeholder="Task Name" value="${data.tasks[i] || 0}">
                        </td>
                        <td class="text-center">
                          <input class="monday_value"  type="text" id="monday_value" name="monday_value" placeholder="0" style="border: none;" value="${data.monday_value[i] || 0}">
                        </td>
                        <td class="text-center">
                          <input class="tuesday_value"  type="text" id="tuesday_value" name="tuesday_value" placeholder="0" style="border: none;" value="${data.tuesday_value[i] || 0}">
                        </td>
                        <td class="text-center">
                          <input class="wednesday_value"  type="text" id="wednesday_value" name="wednesday_value" placeholder="0" style="border: none;" value="${data.wednesday_value[i] || 0}">
                        </td>
                        <td class="text-center">
                          <input class="thursday_value"  type="text" id="thursday_value" name="thursday_value" placeholder="0" style="border: none;" value="${data.thursday_value[i] || 0}">
                        </td>
                        <td class="text-center">
                          <input class="friday_value"  type="text" id="friday_value" name="friday_value" placeholder="0" style="border: none;" value="${data.friday_value[i] || 0}">
                        </td>
                        <td class="text-center">
                          <input class="saturday_value"  type="text" id="saturday_value" name="saturday_value" placeholder="0" style="border: none;" value="${data.saturday_value[i] || 0}">
                        </td>
                        <td class="text-center">
                          <input class="sunday_value"  type="text" id="sunday_value" name="sunday_value" placeholder="0" style="border: none;" value="${data.sunday_value[i] || 0}">
                        </td>       
                        `;
                        taskNameRow.parentNode.insertBefore(newRow, taskNameRow);
                    }
                }
                

                /////////////////////////////////////////////////////////////////////////////////////

                if (!data.leave_date){
                  
                  id5 = ["monday_value", "tuesday_value", "wednesday_value", "thursday_value", "friday_value"]
                  id6 = ["ovt_monday", "ovt_tuesday", "ovt_wednesday", "ovt_thursday", "ovt_friday"]
                  for (i=0; i <= id5.length; i++){
                  var leave_input = document.querySelectorAll('.'+i[id5]);
                  leave_input.forEach((input) => {
                        input.style.backgroundColor = "transparent";
                        input.readOnly = false;
                    });
                    var leave_input1 = document.querySelectorAll('.'+i[id6]);
                  leave_input1.forEach((input) => {
                        input.style.backgroundColor = "transparent";
                        input.readOnly = false;
                    });
                  }
                }
                else{
                  console.log('in1')


      if (data && data.leave_date && data["leave_date"][0]) {
        console.log('here4.1')
          for( var k = 0; k<data["leave_date_days"].length; k++ ){
            console.log('4for')
                  document.querySelectorAll("."+data["leave_date_days"][k]+"_value").forEach(element => {
                    element.value = 0
                    element.setAttribute('readonly', true);
                    element.style.setProperty("background-color", "grey", "important"); });
                    
                    document.getElementById("ovt_"+data["leave_date_days"][k]).value = 0
                    document.getElementById("ovt_"+data["leave_date_days"][k]).setAttribute('readonly', true)
                    document.getElementById("ovt_"+data["leave_date_days"][k]).style.setProperty("background-color", "grey", "important");
                }
              }
      
      
    
      
        
        
        

        
       



        if (data?.project_name && data?.status!="uncheck") {
                    messageBox1.style.display = "block"; // Show the message box
                    // Removing buttons
                    document.getElementById("submitBtn").style.display = "none";
                    document.getElementById("discardBtn").style.display = "none";
                    document.getElementById("saveBtn").style.display = "none";
                    
                    // Making inputs read-only
                    document.getElementById("project_name").readOnly = true;
                    document.getElementById("monday_value").readOnly = true;
                    document.getElementById("tuesday_value").readOnly = true;
                    document.getElementById("wednesday_value").readOnly = true;
                    document.getElementById("thursday_value").readOnly = true;
                    document.getElementById("friday_value").readOnly = true;
                    document.getElementById("saturday_value").readOnly = true;
                    document.getElementById("sunday_value").readOnly = true;
                    document.getElementById("ovt_monday").readOnly = true;
                    document.getElementById("ovt_tuesday").readOnly = true;
                    document.getElementById("ovt_wednesday").readOnly = true;
                    document.getElementById("ovt_thursday").readOnly = true;
                    document.getElementById("ovt_friday").readOnly = true;
                    document.getElementById("ovt_saturday").readOnly = true;
                    document.getElementById("ovt_sunday").readOnly = true;
                    document.getElementById("St").readOnly = true;
                    document.getElementById("ot").readOnly = true;
                    document.getElementById("total_hour").readOnly = true;

                    

                }
      
        

       
    
                }


                
            
            }});   

            
    
    // Add event listener to project name input field
    var inputFields = document.querySelectorAll('input');
    inputFields.forEach(function(input) {
    input.addEventListener('keydown', function(event) {
        if (event.keyCode === 13) {
            event.preventDefault(); // Prevent form submission
            var nextInput = input.parentElement.nextElementSibling.querySelector('input');
            if (nextInput) {
                nextInput.focus(); // Move focus to the next field in the same row
            } 
        }
    });
});
            
        });
      

</script>
<script>
  
  // Calculation hours
  $(function() {


// Calculate total hours
function calculateTotalHours() {
  console.log("inside calculation hours script")
    var total = 0;
    var st = 0;
    var ot = 0;
    var th_mon = 0;
    var th_tue = 0;
    var th_wed = 0;
    var th_thurs = 0;
    var th_fri = 0;
    var th_sat = 0;
    var th_sun = 0;
    
    $('input[class$="_value"], input[class^="ovt_"]').each(function() {
        var value = parseFloat($(this).val()) || 0;
        total += value;
    });
    $('input[class$="_value"]').each(function() {
        var value = parseFloat($(this).val()) || 0;
        st += value;
    });
    $('input[id^="ovt_"]').each(function() {
        var value = parseFloat($(this).val()) || 0;
        ot += value;
    });
    $('input[class$="monday_value"], input[class^="ovt_monday"]').each(function() {
        var value = parseFloat($(this).val()) || 0;
        th_mon += value;
    });
    $('input[class$="tuesday_value"], input[class^="ovt_tuesday"]').each(function() {
        var value = parseFloat($(this).val()) || 0;
        th_tue += value;
    });
    $('input[class$="wednesday_value"], input[class^="ovt_wednesday"]').each(function() {
        var value = parseFloat($(this).val()) || 0;
        th_wed += value;
    });
    $('input[class$="thursday_value"], input[class^="ovt_thursday"]').each(function() {
        var value = parseFloat($(this).val()) || 0;
        th_thurs += value;
    });
    $('input[class$="friday_value"], input[class^="ovt_friday"]').each(function() {
        var value = parseFloat($(this).val()) || 0;
        th_fri += value;
    });
    $('input[class$="saturday_value"], input[class^="ovt_saturday"]').each(function() {
        var value = parseFloat($(this).val()) || 0;
        th_sat += value;
    });
    $('input[class$="sunday_value"], input[class^="ovt_sunday"]').each(function() {
        var value = parseFloat($(this).val()) || 0;
        th_sun += value;
    });

    $('#St').val(st);
    $('#ot').val(ot);
    $('#total_hour').val(total);
    $('#th_monday').val(th_mon);
    $('#th_tuesday').val(th_tue);
    $('#th_wednesday').val(th_wed);
    $('#th_thursday').val(th_thurs);
    $('#th_friday').val(th_fri);
    $('#th_saturday').val(th_sat);
    $('#th_sunday').val(th_sun);
}

// Trigger calculation on input change
$(document).on('input[class$="_value"], input[id^="ovt_"]').on('input', calculateTotalHours);
});
</script>
<script>
  
  //add row
  document.getElementById("addrow").addEventListener("click", function() {
    console.log("inside addRow script")
    console.log('error here3')
    var tbody = document.getElementsByTagName('table')[0].getElementsByTagName('tbody')[0];
    var rows = tbody.getElementsByTagName("tr");
    var taskNameRow = rows[rows.length - 5];
    var newRow = document.createElement("tr");
    newRow.className = "newRow";
    

    var mondayInput = document.querySelector('.monday_value');
    var tuesdayInput = document.querySelector('.tuesday_value');
    var wednesdayInput = document.querySelector('.wednesday_value');
    var thursdayInput = document.querySelector('.thursday_value');
    var fridayInput = document.querySelector('.friday_value');
    var saturdayInput = document.querySelector('.saturday_value');
    var sundayInput = document.querySelector('.sunday_value');

    var mondayColor = window.getComputedStyle(mondayInput).getPropertyValue('background-color');
    var tuesdayColor = window.getComputedStyle(tuesdayInput).getPropertyValue('background-color');
    var wednesdayColor = window.getComputedStyle(wednesdayInput).getPropertyValue('background-color');
    var thursdayColor = window.getComputedStyle(thursdayInput).getPropertyValue('background-color');
    var fridayColor = window.getComputedStyle(fridayInput).getPropertyValue('background-color');
    var saturdayColor = window.getComputedStyle(saturdayInput).getPropertyValue('background-color');
    var sundayColor = window.getComputedStyle(sundayInput).getPropertyValue('background-color');

    
    
    
    
    
    
    
    
    
    let newRowContent = `
                  <td class="text-center">
                      <input class="text-center task-input" type="text" id="task" name="task" placeholder="Task Name">
                  </td>`;

              let days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
              let colors = [mondayColor, tuesdayColor, wednesdayColor, thursdayColor, fridayColor, saturdayColor, sundayColor];

              for(let i = 0; i < days.length; i++) {
                
                
                  if (colors[i] == 'rgb(128, 128, 128)') {
                    
                      newRowContent += `
                      <td class="text-center">
                          <input class="${days[i]}_value" type="text" id="${days[i]}_value" name="${days[i]}_value" placeholder="0" style="border: none; background-color: rgb(128,128,128);" value="0" readonly>
                      </td>`;
                  } else {
                    
                      newRowContent += `
                      <td class="text-center">
                          <input class="${days[i]}_value" type="text" id="${days[i]}_value" name="${days[i]}_value" placeholder="0" style="border: none;">
                      </td>`;
                  }
              }

              newRow.innerHTML = newRowContent;
    taskNameRow.parentNode.insertBefore(newRow, taskNameRow);
    
});
</script>
<script>
  
  //save button
  document.getElementById("saveBtn").addEventListener("click", function() {
    console.log("inside saveBtn script")
        // Get the table data
        console.log("save in")
        var th_hour = [
                document.getElementById('th_monday').value,
                document.getElementById('th_tuesday').value,
                document.getElementById('th_wednesday').value,
                document.getElementById('th_thursday').value,
                document.getElementById('th_friday').value,
                document.getElementById('th_saturday').value,
                document.getElementById('th_sunday').value
            ];
        var tableData = {
            start_date: document.getElementById('start_date').value,
            end_date: document.getElementById('end_date').value,
            project_name: document.getElementById('project_name').value,
            ovt_monday: document.getElementById('ovt_monday').value,
            ovt_tuesday: document.getElementById('ovt_tuesday').value,
            ovt_wednesday: document.getElementById('ovt_wednesday').value,
            ovt_thursday: document.getElementById('ovt_thursday').value,
            ovt_friday: document.getElementById('ovt_friday').value,
            ovt_saturday: document.getElementById('ovt_saturday').value,
            ovt_sunday: document.getElementById('ovt_sunday').value,
            St: document.getElementById('St').value,
            ot: document.getElementById('ot').value,
            total_hour: document.getElementById('total_hour').value,
            th_hour: th_hour,
            role: document.getElementById('role').textContent
            
        };
        
        // Store the table data in local storage
        localStorage.setItem('tableData', JSON.stringify(tableData));
        var taskInputs = {
            monday_value : Array.from(document.querySelectorAll('.monday_value')).map(input => input.value),
            tuesday_value : Array.from(document.querySelectorAll('.tuesday_value')).map(input => input.value),
            wednesday_value : Array.from(document.querySelectorAll('.wednesday_value')).map(input => input.value),
            thursday_value : Array.from(document.querySelectorAll('.thursday_value')).map(input => input.value),
            friday_value : Array.from(document.querySelectorAll('.friday_value')).map(input => input.value),
            saturday_value : Array.from(document.querySelectorAll('.saturday_value')).map(input => input.value),
            sunday_value : Array.from(document.querySelectorAll('.sunday_value')).map(input => input.value),
            th_hour : Array.from(document.querySelectorAll('.th_hour')).map(input => input.value),
            tasks : Array.from(document.querySelectorAll('.task-input')).map(input => input.value),
        }
        
        localStorage.setItem('taskInputs', JSON.stringify(taskInputs));
        console.log('local store has been set')

        var messageBox = document.createElement("div");
        messageBox.textContent = "The Values are Saved";
        messageBox.classList.add("alert", "alert-success");
        var targetElement = document.getElementById("alertdiv");

        // Append the message box to the selected element
        targetElement.appendChild(messageBox);
        

        // Show the message box
        setTimeout(function() {
            messageBox.remove();
            console.log("table data is ", tableData)
        }, 1700);
});
</script>
<script>
  
  // windows on load, check there is data for the date
  window.addEventListener('load', function() {
    console.log("inside windows.load script")
   
    var startDate = new Date(document.getElementById('start_date').value);
    var endDate = new Date(document.getElementById('end_date').value);
    console.log(startDate, endDate)
    
    var formattedStartDate = startDate.toISOString().split('T')[0];
    var formattedEndDate = endDate.toISOString().split('T')[0];
    
    fetch("{% url 'timesheets_create' %}", {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}'
        },
        body: JSON.stringify({
            'start_date': formattedStartDate,
            'end_date': formattedEndDate,
            'method_1': "first_fetch"
        })
    })
    .then(response => response.json())
    .then(data => {
      console.log('.then', data)
      if(data && data.monday_value){
        console.log('6in')
        if(tableData){
          localStorage.removeItem('savedTableData');
          localStorage.removeItem('taskInputs');
          console.log("removed table data")
        }
      }
      console.log('5555', data)
      if (!data || !data.monday_value){
          console.log("inside table data")
          

// Check if there is any saved table data in local storage
var savedTableData = localStorage.getItem('tableData');
var taskInputs = localStorage.getItem('taskInputs')
var role = document.getElementById('role').textContent;
var role_checking = JSON.parse(savedTableData);

        
        if (savedTableData && role_checking.start_date != formattedStartDate){
          console.log('2')
          savedTableData = null;
          taskInputs = null;
        }

if (savedTableData && role_checking.role != role && role_checking.start_date != startDate ){
  console.log("true")
          savedTableData = null;
          taskInputs = null;
        }


if (savedTableData) {
  console.log("savedTableData")
    // Parse the saved table data
    var tableData = JSON.parse(savedTableData);
    applyDynamicRowStyling()

    // Populate the table with the saved data
    document.getElementById('start_date').value = tableData.start_date;
    document.getElementById('end_date').value = tableData.end_date;
    document.getElementById('project_name').value = tableData.project_name;
    
    document.getElementById('ovt_monday').value = tableData.ovt_monday;
    document.getElementById('ovt_tuesday').value = tableData.ovt_tuesday;
    document.getElementById('ovt_wednesday').value = tableData.ovt_wednesday;
    document.getElementById('ovt_thursday').value = tableData.ovt_thursday;
    document.getElementById('ovt_friday').value = tableData.ovt_friday;
    document.getElementById('ovt_saturday').value = tableData.ovt_saturday;
    document.getElementById('ovt_sunday').value = tableData.ovt_sunday;
    document.getElementById('St').value = tableData.St;
    document.getElementById('ot').value = tableData.ot;
    document.getElementById('total_hour').value = tableData.total_hour;

    document.getElementById('th_monday').value = tableData.th_hour[0];
    document.getElementById('th_tuesday').value = tableData.th_hour[1];
    document.getElementById('th_wednesday').value = tableData.th_hour[2];
    document.getElementById('th_thursday').value = tableData.th_hour[3];
    document.getElementById('th_friday').value = tableData.th_hour[4];
    document.getElementById('th_saturday').value = tableData.th_hour[5];
    document.getElementById('th_sunday').value = tableData.th_hour[6];

    var data6 = JSON.parse(localStorage.getItem('taskInputs'));
    
    if (data6.monday_value.length <= 1) {
      
                document.getElementById("task").value = data6?.tasks[0] || '';
                document.getElementById("monday_value").value = data6?.monday_value[0] || '';
                document.getElementById("tuesday_value").value = data6?.tuesday_value[0] || '';
                document.getElementById("wednesday_value").value = data6?.wednesday_value[0] || '';
                document.getElementById("thursday_value").value = data6?.thursday_value[0] || '';
                document.getElementById("friday_value").value = data6?.friday_value[0] || '';
                document.getElementById("saturday_value").value = data6?.saturday_value[0] || '';
                document.getElementById("sunday_value").value = data6?.sunday_value[0] || '';

    }
    
    else{
      
                document.getElementById("task").value = data6?.tasks[0] || '';
                document.getElementById("monday_value").value = data6?.monday_value[0] || '';
                document.getElementById("tuesday_value").value = data6?.tuesday_value[0] || '';
                document.getElementById("wednesday_value").value = data6?.wednesday_value[0] || '';
                document.getElementById("thursday_value").value = data6?.thursday_value[0] || '';
                document.getElementById("friday_value").value = data6?.friday_value[0] || '';
                document.getElementById("saturday_value").value = data6?.saturday_value[0] || '';
                document.getElementById("sunday_value").value = data6?.sunday_value[0] || '';
                var totallength = (data6.monday_value.length) 
                console.log('error here4')
                var tbody = document.getElementsByTagName('table')[0].getElementsByTagName('tbody')[0];
                
                var rows = tbody.getElementsByTagName("tr");
                var taskNameRow = rows[rows.length - 5];
                
                for (var i = 1; i <=totallength-1; i++) {
                    var newRow = document.createElement("tr");
                    newRow.className = "newRow";
                    console.log()
                    
                                          
                    newRow.innerHTML += `
                    
                    
                    <td class="text-center">
                          <input class="text-center task-input"  type="text" id="task" name="task" placeholder="Task Name" value="${data6.tasks[i] || 0}">
                        </td>
                        <td class="text-center">
                          <input class="monday_value"  type="text" id="monday_value" name="monday_value" placeholder="0" style="border: none;" value="${data6.monday_value[i] || 0}">
                        </td>
                        <td class="text-center">
                          <input class="tuesday_value"  type="text" id="tuesday_value" name="tuesday_value" placeholder="0" style="border: none;" value="${data6.tuesday_value[i] || 0}">
                        </td>
                        <td class="text-center">
                          <input class="wednesday_value"  type="text" id="wednesday_value" name="wednesday_value" placeholder="0" style="border: none;" value="${data6.wednesday_value[i] || 0}">
                        </td>
                        <td class="text-center">
                          <input class="thursday_value"  type="text" id="thursday_value" name="thursday_value" placeholder="0" style="border: none;" value="${data6.thursday_value[i] || 0}">
                        </td>
                        <td class="text-center">
                          <input class="friday_value"  type="text" id="friday_value" name="friday_value" placeholder="0" style="border: none;" value="${data6.friday_value[i] || 0}">
                        </td>
                        <td class="text-center">
                          <input class="saturday_value"  type="text" id="saturday_value" name="saturday_value" placeholder="0" style="border: none;" value="${data6.saturday_value[i] || 0}">
                        </td>
                        <td class="text-center">
                          <input class="sunday_value"  type="text" id="sunday_value" name="sunday_value" placeholder="0" style="border: none;" value="${data6.sunday_value[i] || 0}">
                        </td>
                    `;
                    taskNameRow.parentNode.insertBefore(newRow, taskNameRow);
                }
    }}}
        
    
        

        ///////// leave backend ////////////////////
    // Define an array of IDs of the input fields
    var dayIds = ['monday_value', 'tuesday_value', 'wednesday_value', 'thursday_value', 'friday_value', 'saturday_value','sunday_value'];
    
    var ovtIds = ['ovt_monday', 'ovt_tuesday', 'ovt_wednesday', 'ovt_thursday', 'ovt_friday', 'ovt_saturday', 'ovt_sunday'];
    
    
    console.log('here4')
    console.log(data)
if (data && data.leave_date && data["leave_date"][0]) {
  console.log('here4.1')
    for( var k = 0; k<=data["leave_date"].length; k++ ){
      if (data && data.leave_date && data["leave_date"][0]) {
        console.log('here4.1')
          for( var k = 0; k<data["leave_date_days"].length; k++ ){
            console.log('4for')
                  document.querySelectorAll("."+data["leave_date_days"][k]+"_value").forEach(element => {
                    element.value = 0
                    element.setAttribute('readonly', true);
                    element.style.setProperty("background-color", "grey", "important"); });
                    
                    document.getElementById("ovt_"+data["leave_date_days"][k]).value = 0
                    document.getElementById("ovt_"+data["leave_date_days"][k]).setAttribute('readonly', true)
                    document.getElementById("ovt_"+data["leave_date_days"][k]).style.setProperty("background-color", "grey", "important");
                }
              }
    
    if (data && data.project_name && data.status!="uncheck") {
      console.log('here5if')
                    messageBox1.style.display = "block"; // Show the message box
                    // Removing buttons
                    document.getElementById("submitBtn").style.display = "none";
                    document.getElementById("discardBtn").style.display = "none";
                    document.getElementById("saveBtn").style.display = "none";
                    
                    // Making inputs read-only
                    document.getElementById("project_name").readOnly = true;
                    document.getElementById("monday_value").readOnly = true;
                    document.getElementById("tuesday_value").readOnly = true;
                    document.getElementById("wednesday_value").readOnly = true;
                    document.getElementById("thursday_value").readOnly = true;
                    document.getElementById("friday_value").readOnly = true;
                    document.getElementById("saturday_value").readOnly = true;
                    document.getElementById("sunday_value").readOnly = true;
                    document.getElementById("ovt_monday").readOnly = true;
                    document.getElementById("ovt_tuesday").readOnly = true;
                    document.getElementById("ovt_wednesday").readOnly = true;
                    document.getElementById("ovt_thursday").readOnly = true;
                    document.getElementById("ovt_friday").readOnly = true;
                    document.getElementById("ovt_saturday").readOnly = true;
                    document.getElementById("ovt_sunday").readOnly = true;
                    document.getElementById("St").readOnly = true;
                    document.getElementById("ot").readOnly = true;
                    document.getElementById("total_hour").readOnly = true;

                    

                }
    else{
      console.log('here5else')
      messageBox1.style.display = "none"; // Hide the message box
                      document.getElementById("submitBtn").style.display = "block";
                      document.getElementById("discardBtn").style.display = "block";
                      document.getElementById("saveBtn").style.display = "block";

                     // Get the input fields
var inputFields = document.querySelectorAll('input[type="text"]');

// Loop through each input field
inputFields.forEach(function(field) {
    // Check if the background color is grey
    if (window.getComputedStyle(field).backgroundColor !== 'rgb(128, 128, 128)') {
        // If not grey, set the readOnly attribute to false
        field.readOnly = false;
    }
});
    }}}
    if (data?.project_name && data?.status!="uncheck") {
                    messageBox1.style.display = "block"; // Show the message box
                    // Removing buttons
                    document.getElementById("submitBtn").style.display = "none";
                    document.getElementById("discardBtn").style.display = "none";
                    document.getElementById("saveBtn").style.display = "none";
                    
                    // Making inputs read-only
                    document.getElementById("project_name").readOnly = true;
                    document.getElementById("monday_value").readOnly = true;
                    document.getElementById("tuesday_value").readOnly = true;
                    document.getElementById("wednesday_value").readOnly = true;
                    document.getElementById("thursday_value").readOnly = true;
                    document.getElementById("friday_value").readOnly = true;
                    document.getElementById("saturday_value").readOnly = true;
                    document.getElementById("sunday_value").readOnly = true;
                    document.getElementById("ovt_monday").readOnly = true;
                    document.getElementById("ovt_tuesday").readOnly = true;
                    document.getElementById("ovt_wednesday").readOnly = true;
                    document.getElementById("ovt_thursday").readOnly = true;
                    document.getElementById("ovt_friday").readOnly = true;
                    document.getElementById("ovt_saturday").readOnly = true;
                    document.getElementById("ovt_sunday").readOnly = true;
                    document.getElementById("St").readOnly = true;
                    document.getElementById("ot").readOnly = true;
                    document.getElementById("total_hour").readOnly = true;

                    

                }
    else{
      messageBox1.style.display = "none"; // Hide the message box
                      document.getElementById("submitBtn").style.display = "block";
                      document.getElementById("discardBtn").style.display = "block";
                      document.getElementById("saveBtn").style.display = "block";

                     // Get the input fields
var inputFields = document.querySelectorAll('input[type="text"]');

// Loop through each input field
inputFields.forEach(function(field) {
    // Check if the background color is grey
    if (window.getComputedStyle(field).backgroundColor !== 'rgb(128, 128, 128)') {
        // If not grey, set the readOnly attribute to false
        field.readOnly = false;
    }
});
    }
    
        console.log("data", data)
        

    



    });
});
console.log("windows load ended")
</script>
<script>
  
  //discard button
  document.getElementById("discardBtn").addEventListener("click", function() {
    console.log("inside discardBtn script")
        var confirmation = confirm("Are you sure you want to discard the values?")
    // Reset the input fields to their initial values
        if (confirmation) {
        document.getElementById("project_name").value = "";
        document.getElementById("monday_value").value = "";
        document.getElementById("tuesday_value").value = "";
        document.getElementById("wednesday_value").value = "";
        document.getElementById("thursday_value").value = "";
        document.getElementById("friday_value").value = "";
        document.getElementById("saturday_value").value = "";
        document.getElementById("sunday_value").value = "";
        document.getElementById("ovt_monday").value = "";
        document.getElementById("ovt_tuesday").value = "";
        document.getElementById("ovt_wednesday").value = "";
        document.getElementById("ovt_thursday").value = "";
        document.getElementById("ovt_friday").value = "";
        document.getElementById("ovt_saturday").value = "";
        document.getElementById("ovt_sunday").value = "";
        document.getElementById("St").value = "";
        document.getElementById("ot").value = "";
        document.getElementById("total_hour").value = "";
        document.getElementById('th_monday').value = "";
        document.getElementById('th_tuesday').value = "";
        document.getElementById('th_wednesday').value = "";
        document.getElementById('th_thursday').value = "";
        document.getElementById('th_friday').value = "";
        document.getElementById('th_saturday').value = "";
        document.getElementById('th_sunday').value = "";

       // Reset the task inputs to their initial values
       var taskInputs = document.querySelectorAll('.task-input');
        taskInputs.forEach((input) => {
            input.value = "";
        });
        // Remove the newly created rows
        

        // Remove the table data and task inputs from local storage
        localStorage.removeItem('tableData');
        localStorage.removeItem('taskInputs');
        ;
}});
</script>
<script>
  
  // submit button
  document.getElementById("submitBtn").addEventListener("click", function() {
    console.log("inside submit script")
        event.preventDefault()
        var taskInputs = document.querySelectorAll('.task-input');
        var tasks = Array.from(taskInputs).map(input => input.value);
        var start_date = document.getElementById('start_date').value;
        var end_date = document.getElementById('end_date').value;
        var project_name = document.getElementById('project_name').value || '0';
        var monday_value = Array.from(document.querySelectorAll('.monday_value')).map(input => input.value) || '0';
        var tuesday_value = Array.from(document.querySelectorAll('.tuesday_value')).map(input => input.value) || '0';
        var wednesday_value = Array.from(document.querySelectorAll('.wednesday_value')).map(input => input.value) || '0';
        var thursday_value = Array.from(document.querySelectorAll('.thursday_value')).map(input => input.value) || '0';
        var friday_value = Array.from(document.querySelectorAll('.friday_value')).map(input => input.value) || '0';
        var saturday_value = Array.from(document.querySelectorAll('.saturday_value')).map(input => input.value) || '0';
        var sunday_value = Array.from(document.querySelectorAll('.sunday_value')).map(input => input.value) || '0';
        var th_hour = [
                document.getElementById('th_monday').value,
                document.getElementById('th_tuesday').value,
                document.getElementById('th_wednesday').value,
                document.getElementById('th_thursday').value,
                document.getElementById('th_friday').value,
                document.getElementById('th_saturday').value,
                document.getElementById('th_sunday').value
            ]; 
        var ovt_monday = document.getElementById('ovt_monday').value || '0';
        var ovt_tuesday = document.getElementById('ovt_tuesday').value || '0';
        var ovt_wednesday = document.getElementById('ovt_wednesday').value || '0';
        var ovt_thursday = document.getElementById('ovt_thursday').value || '0';
        var ovt_friday = document.getElementById('ovt_friday').value || '0';
        var ovt_saturday = document.getElementById('ovt_saturday').value || '0';
        var ovt_sunday = document.getElementById('ovt_sunday').value || '0';
        var St = document.getElementById('St').value || '0';
        var ot = document.getElementById('ot').value || '0';
        var total_hour = document.getElementById('total_hour').value || '0';
        

        
        
        
        // Get the form data
        //var formData = new FormData(document.getElementById("timeSheetForm"));

    // Send the form data to the server using fetch
    fetch("{% url 'timesheets_create' %}", {
                  // enter your url
        method: "POST",
        headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
        body: JSON.stringify({
                'start_date': start_date,
                'end_date': end_date,
                'project_name': project_name,
                'monday_value': monday_value,
                'tuesday_value': tuesday_value,
                'wednesday_value': wednesday_value,
                'thursday_value': thursday_value,
                'friday_value': friday_value,
                'saturday_value': saturday_value,
                'sunday_value': sunday_value,
                'th_hour': th_hour,
                'ovt_monday': ovt_monday,
                'ovt_tuesday': ovt_tuesday,
                'ovt_wednesday': ovt_wednesday,
                'ovt_thursday': ovt_thursday,
                'ovt_friday': ovt_friday,
                'ovt_saturday': ovt_saturday,
                'ovt_sunday': ovt_sunday,
                'St': St,
                'ot': ot,
                'total_hour': total_hour,
                'tasks': tasks,
                

            })
    })
    .then(function(response) {
        // Handle the response from the server
        if (response.ok) {
            return response.json();
            
        } else {
            throw new Error("Error: " + response.status);
        }
    })
    .then(function(data) {
        //
    
        var messageBox_submit = document.createElement("div");
        messageBox_submit.textContent = "Time Sheet Submitted";
        messageBox_submit.classList.add("alert", "alert-success");
        
        var targetElement = document.getElementById("alertdiv");

        // Append the message box to the selected element
        targetElement.appendChild(messageBox_submit);
        // document.body.appendChild(messageBox_submit);

        // Show the message box
        setTimeout(function() {
            messageBox_submit.remove();
            location.reload();
        }, 3000);
        
        })
});
</script>


{% endblock pageContent %}
