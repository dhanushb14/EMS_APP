{% extends "employee_information/base.html" %} {% block pageContent %}
<style>
    .table-responsive {
    overflow-x: auto;
}

@media screen and (max-width: 768px) {
    .table-responsive {
        display: block;
        width: 100%;
    }
    .my-table th {
        font-size: 12px; /* Adjust this value to your preference */
        word-wrap: break-word;
        white-space: normal;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        padding: 5px;
    }
    .my-table {
        table-layout: auto;
    }
}

    .italic-text {
        
        white-space: nowrap;
    }
    .spaced-table {
        border-collapse: separate;
        border-spacing: 0 6px;
    }
    .spaced-table th {
        color: white !important;
    }
    .button-group {
    display: flex;
    justify-content: flex-end;
    }
    .no-border {
    border: none !important;
    }

    .message-box {
        position: fixed;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        background-color: black;
        color: white;
        border: 1px solid #ccc;
        padding: 10px;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .message-box.show {
        opacity: 1;
        display: block;
        animation: fadeOut 0.5s ease-in-out;
    }
    .message1-box {
        position: relative;
        background-color: transparent;
        color: black;
        border: 1px solid #ccc;
        padding: 10px;
        border-radius: 5px;
        margin-top: 10px;
        white-space: nowrap; /* Prevents the text from wrapping onto the next line */
        width: 100%; /* Ensures the div takes up the full width of the parent */
        text-align: center; /* Centers the text within the div */
        border: none;
        
    }

    .message1-box.show {
        opacity: 1;
        display: block;
        animation: fadeOut 0.5s ease-in-out;
    }


    @keyframes fadeOut {
        0% {
            opacity: 1;
        }
        100% {
            opacity: 0;
        }
}
.my-table {
        table-layout: fixed;
        width: 100%;
        
    }
    .my-table th, .my-table td {
    width: 100px;
    
}
.mdc-card {
    padding: 10px; /* Adjust this value */
}
#project_name::placeholder {
        font-size: 15px; /* Adjust this value to your preference */
    }

</style>
<div class="italic-text">
    <h2> Time Sheet </h2>
</div>
<div class="mdc-layout-grid__cell stretch-card mdc-layout-grid__cell--span-12">
    <div class="mdc-card py-2" style="background-color: #dcd0ff;">
        <div class="d-flex justify-content-start align-items-center">
            <label for="start_date" class="me-2">Start Date </label>
            <input type="date" id="start_date" name="start_date" class="me-4">
            <label for="end_date" class="me-2">End Date</label>
            <input type="date" id="end_date" name="end_date" class="me-5" readonly>
            <label for="end_date" class="me-2">Project name</label>
            <input type="text" id="project_name" name="project_name" placeholder="" required>
            
        </div>
    </div>
</div>
<div class="mdc-layout-grid__cell stretch-card mdc-layout-grid__cell--span-12">
    <div class="mdc-card">
        <div class="table-responsive">
            <form id="timeSheetForm" method="post" data-username="{{ user }}">
            <table class="table table-bordered spaced-table my-table">
                <colgroup>
                    <col width="15%">
                    <col width="10%">
                    <col width="10%">
                    <col width="10%">
                    <col width="10%">
                    <col width="10%">
                    <col width="10%">
                    <col width="10%">
                    <col width="2.3%">
                </colgroup>
                <thead>
                    <tr style="background-color: grey; height: 35px;">
                        <th class="px-2 text-center py-1">Tasks</th>
                        <th class="text-center py-1">Monday</th>
                        <th class="text-center py-1">Tuesday</th>
                        <th class="text-center py-1">Wednesday</th>
                        <th class="text-center py-1">Thursday</th>
                        <th class="text-center py-1">Friday</th>
                        <th class="text-center py-1">Saturday</th>
                        <th class="text-center py-1">Sunday</th>
                        <th style="border: none; background-color: white !important;"></th>
                    </tr>
                </thead>
                <tbody>
                    <tr style="background-color: #e0e0e0;" id="tasknamerow">
                        <td class="px-2 py-1 text-center">
                            <input class="task-input" type="text" id="task" name="task" placeholder="Task Name"  style="width: 100%;"> 
                        </td>
                        <td class="px-2 py-1 text-center">
                            <input class="monday_value"  type="text" id="monday_value" name="monday_value" placeholder="0" style="width: 50px; border:none;">
                        </td>
                        <td class="px-2 py-1 text-center">
                            <input class="tuesday_value"  type="text" id="tuesday_value" name="tuesday_value" placeholder="0" style="width: 50px; border:none;">
                        </td>
                        <td class="px-2 py-1 text-center">
                            <input class="wednesday_value"  type="text" id="wednesday_value" name="wednesday_value" placeholder="0" style="width: 50px; border:none;">
                        </td>
                        <td class="px-2 py-1 text-center">
                            <input class="thursday_value"  type="text" id="thursday_value" name="thursday_value" placeholder="0" style="width: 50px; border:none;">
                        </td>
                        <td class="px-2 py-1 text-center">
                            <input class="friday_value"  type="text" id="friday_value" name="friday_value" placeholder="0" style="width: 50px; border:none;">
                        </td>
                        <td class="px-2 py-1 text-center">
                            <input class="saturday_value"  type="text" id="saturday_value" name="saturday_value" placeholder="0" style="width: 50px; border:none;">
                        </td>
                        <td class="px-2 py-1 text-center">
                            <input class="sunday_value"  type="text" id="sunday_value" name="sunday_value" placeholder="0" style="width: 50px; border:none;">
                        </td>
                        <td class="px-2 py-1 text-center" style="background-color: white; border: none;">
                            <button type="button" id="addRow">+</button>
                        </td>
                    </tr>
                    
                    <tr style="background-color: #e0e0e0;" class="th_hour">
                        <td class="px-2 py-1 text-center"  >
                            Total Hours
                        </td>
                        <td class="px-2 py-1 text-center">
                            <input type="text" id="th_monday" class="th_monday" name="" value="0" style="width: 50px; border: none;" readonly>
                        </td>
                        <td class="px-2 py-1 text-center">
                            <input type="text" id="th_tuesday" class="th_tuesday" name="" value="0" style="width: 50px; border: none;"readonly>
                        </td>
                        <td class="px-2 py-1 text-center">
                            <input type="text" id="th_wednesday" class="th_wednesday" name="" value="0" style="width: 50px; border: none;"readonly>
                        </td>
                        <td class="px-2 py-1 text-center">
                            <input type="text" id="th_thursday" class="th_thursday" name="" value="0" style="width: 50px; border: none;"readonly>
                        </td>
                        <td class="px-2 py-1 text-center">
                            <input type="text" id="th_friday" class="th_friday" name="" value="0" style="width: 50px; border: none;"readonly>
                        </td>
                        <td class="px-2 py-1 text-center">
                            <input type="text" id="th_saturday" class="th_saturday" name="" value="0" style="width: 50px; border: none;"readonly>
                        </td>
                        <td class="px-2 py-1 text-center">
                            <input type="text" id="th_sunday" class="th_sunday" name="" value="0" style="width: 50px; border: none;"readonly>
                        </td>
                    </tr>
                    
                    <tr style="background-color: #e0e0e0;">
                        <td class="px-2 py-1 text-center">
                            Overtime Hours 
                        </td>
                        <td class="px-2 py-1 text-center">
                            <input type="text" id="ovt_monday" name="ovt_monday" placeholder="0" style="width: 50px; border:none;">
                        </td>
                        <td class="px-2 py-1 text-center">
                            <input type="text" id="ovt_tuesday" name="ovt_tuesday" placeholder="0"  style="width: 50px; border:none;">
                        </td>
                        <td class="px-2 py-1 text-center">
                            <input type="text" id="ovt_wednesday" name="ovt_wednesday" placeholder="0"  style="width: 50px; border:none;">
                        </td>
                        <td class="px-2 py-1 text-center">
                            <input type="text" id="ovt_thursday" name="ovt_thursday" placeholder="0" style="width: 50px; border:none;">
                        </td>
                        <td class="px-2 py-1 text-center">
                            <input type="text" id="ovt_friday" name="ovt_friday" placeholder="0" style="width: 50px; border:none;">
                        </td>
                        <td class="px-2 py-1 text-center">
                            <input type="text" id="ovt_saturday" name="ovt_saturday" placeholder="0" style="width: 50px; border:none;">
                        </td>
                        <td class="px-2 py-1 text-center">
                            <input type="text" id="ovt_sunday" name="ovt_sunday" placeholder="0" style="width: 50px; border:none;">
                        </td>
                    </tr>
                    
                    <tr>
                        <td colspan="8" class="px-2 py-1 text-center no-border">&nbsp;</td>
                    </tr>
                    <tr>
                        <td colspan="8" class="px-2 py-1 text-center no-border">&nbsp;</td>
                    </tr>
                    <tr style="background-color: #e0e0e0;" id="calculationrow">
                        <td class="px-2 py-1 text-center" colspan="2">
                            Standard Time: &nbsp;&nbsp;&nbsp&nbsp;
                            <input type="text" id="St" name="ST" placeholder="0" value="0" style="width: 50px;" readonly>
                        </td>
                        <td class="px-2 py-1 text-center" colspan="2">
                            Over Time: &nbsp;&nbsp;&nbsp&nbsp;
                            <input type="text" id="ot" name="ST" placeholder="0" value="0" style="width: 50px" readonly>
                        </td>
                        <td class="px-2 py-1 text-center" colspan="2">
                            Total Time Spent: &nbsp;&nbsp;&nbsp&nbsp;
                            <input type="text" id="total_hour" name="total_hour" placeholder="0" value="0" style="width: 50px" readonly>
                        </td>
                    </tr>
                    <tr id="message">
                        <td colspan="8" class="px-2 py-1 text-center no-border">&nbsp;</td>
                    </tr>
                     
                </tbody>
                
            </table>
                  
        </div>
        
        <div id="parent">
            <button type="button" id="saveBtn" class="btn btn-primary" style="float: left; margin-right: 10px;">Save</button>
            <button type="button" id="discardBtn" class="btn btn-secondary" style="float: left;">Discard</button>
            <button type="submit" id="submitBtn" class="btn btn-success" style="float: right;">Submit</button>
        </div>
        
        </form>
        
    </div>
</div>
{% endblock pageContent %} {% block ScriptBlock %}
<script>
    document.getElementById("addRow").addEventListener("click", function() {
    
    var tbody = document.getElementById("timeSheetForm").getElementsByTagName('table')[0].getElementsByTagName('tbody')[0];
    var rows = tbody.getElementsByTagName("tr");
    var taskNameRow = rows[rows.length - 6];
    var newRow = document.createElement("tr");
    
    newRow.style.backgroundColor = "#e0e0e0";
    newRow.innerHTML = `
    <td class="px-2 py-1 text-center">
                            <input class="task-input" type="text" id="monday_task" name="monday_task" placeholder="Task Name" style="width: 100%"> 
                        </td>
                        <td class="px-2 py-1 text-center">
                            <input class="monday_value" type="text" id="monday_value" name="monday_value" placeholder="0"  style="width: 50px; border:none;">
                        </td>
                        <td class="px-2 py-1 text-center">
                            <input class="tuesday_value"  type="text" id="tuesday_value" name="tuesday_value" placeholder="0" style="width: 50px; border:none;">
                        </td>
                        <td class="px-2 py-1 text-center">
                            <input class="wednesday_value"  type="text" id="wednesday_value" name="wednesday_value" placeholder="0" style="width: 50px; border:none;">
                        </td>
                        <td class="px-2 py-1 text-center">
                            <input class="thursday_value"  type="text" id="thursday_value" name="thursday_value" placeholder="0" style="width: 50px; border:none;">
                        </td>
                        <td class="px-2 py-1 text-center">
                            <input class="friday_value"  type="text" id="friday_value" name="friday_value" placeholder="0"  style="width: 50px; border:none;">
                        </td>
                        <td class="px-2 py-1 text-center">
                            <input class="saturday_value"  type="text" id="saturday_value" name="saturday_value" placeholder="0" style="width: 50px; border:none;">
                        </td>
                        <td class="px-2 py-1 text-center">
                            <input class="sunday_value"  type="text" id="sunday_value" name="sunday_value" placeholder="0" style="width: 50px; border:none;">
                        </td>
        
    `;
    taskNameRow.parentNode.insertBefore(newRow, taskNameRow);
    
});
    
    function getPreviousMonday() {
        var date = new Date();
        if (date.getUTCHours() < 6) {
            date.setUTCDate(date.getUTCDate() - 1);
        }
        var day = date.getUTCDay();
        var prevMonday;

        if(day === 0){
            prevMonday = new Date(date.getTime() - 6 * 24 * 60 * 60 * 1000);
        }
        else{
            prevMonday = new Date(date.getTime() - (day - 1) * 24 * 60 * 60 * 1000);
        }

        return prevMonday;
    }

    $(function() {
        var previousMonday = getPreviousMonday();
        var formattedDate = previousMonday.toISOString().split('T')[0];
        $('#start_date').val(formattedDate);
        var startDate = new Date(formattedDate);
        var endDate = new Date(startDate.getTime() + (6 * 24 * 60 * 60 * 1000)); // Add 6 days to start date
        var formattedEndDate = endDate.toISOString().split('T')[0]; // Format the end date as YYYY-MM-DD
        $('#end_date').val(formattedEndDate);

        document.getElementById('start_date').addEventListener('change', function() {
            
            var startDate = new Date(this.value);
            var day = startDate.getDay();
            var diff = startDate.getDate() - day + (day === 0 ? -6 : 1); // Calculate the difference to the previous Monday
            var mondayDate = new Date(startDate.setDate(diff));
            var formattedStartDate = mondayDate.toISOString().split('T')[0];
            var endDate = new Date(mondayDate.getTime() + (6 * 24 * 60 * 60 * 1000)); // Add 6 days to start date
            var formattedEndDate = endDate.toISOString().split('T')[0]; // Format the end date as YYYY-MM-DD
            document.getElementById('end_date').value = formattedEndDate;
            document.getElementById('start_date').value = formattedStartDate;
            var formattedStartDate = startDate.toISOString().split('T')[0];
            var formattedEndDate = endDate.toISOString().split('T')[0];
            var username = document.body.getAttribute('data-username');
            console.log(username);
            fetch("{% url 'timesheets_create' %}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({
                'start_date': formattedStartDate,
                'end_date': formattedEndDate,
                'username':username,
                'method_1': "first_fetch"
            })
        })
        .then(response => response.json())
        .then(data => {
                
                // data is not empty, create HTML elements to display the data
                let table = document.getElementById('yourTableId')
                document.getElementById("project_name").value = data?.project_name || '';
                document.getElementById("monday_value").value = data?.monday_value || '0';
                document.getElementById("tuesday_value").value = data?.tuesday_value || '0';
                document.getElementById("wednesday_value").value = data?.wednesday_value || '0';
                document.getElementById("thursday_value").value = data?.thursday_value || '0';
                document.getElementById("friday_value").value = data?.friday_value || '0';
                document.getElementById("saturday_value").value = data?.saturday_value || '0';
                document.getElementById("sunday_value").value = data?.sunday_value || '0';
                document.getElementById("ovt_monday").value = data?.ovt_monday || '0';
                document.getElementById("ovt_tuesday").value = data?.ovt_tuesday || '0';
                document.getElementById("ovt_wednesday").value = data?.ovt_wednesday || '0';
                document.getElementById("ovt_thursday").value = data?.ovt_thursday || '0';
                document.getElementById("ovt_friday").value = data?.ovt_friday || '0';
                document.getElementById("ovt_saturday").value = data?.ovt_saturday || '0';
                document.getElementById("ovt_sunday").value = data?.ovt_sunday || '0';
                document.getElementById("St").value = data?.St || '0';
                document.getElementById("ot").value = data?.ot || '0';
                document.getElementById("total_hour").value = data?.total_hour || '0';
                document.getElementById("th_monday").value = data?.th_hour[0] || '0';
                document.getElementById("th_tuesday").value = data?.th_hour[1] || '0';
                document.getElementById("th_wednesday").value = data?.th_hour[2] || '0';
                document.getElementById("th_thursday").value = data?.th_hour[3] || '0';
                document.getElementById("th_friday").value = data?.th_hour[4] || '0';
                document.getElementById("th_saturday").value = data?.th_hour[5] || '0';
                document.getElementById("th_sunday").value = data?.th_hour[6] || '0';

                console.log("here4")
                console.log(data)
                if (data.monday_value.length <= 1) {
                    document.getElementById("task").value = data?.tasks[0] || '';
                    document.getElementById("monday_value").value = data?.monday_value[0] || '0';
                    document.getElementById("tuesday_value").value = data?.tuesday_value[0] || '0';
                    document.getElementById("wednesday_value").value = data?.wednesday_value[0] || '0';
                    document.getElementById("thursday_value").value = data?.thursday_value[0] || '0';
                    document.getElementById("friday_value").value = data?.friday_value[0] || '0';
                    document.getElementById("saturday_value").value = data?.saturday_value[0] || '0';
                    document.getElementById("sunday_value").value = data?.sunday_value[0] || '0';

                }
                else{
                    document.getElementById("task").value = data?.tasks[0] || '';
                    document.getElementById("monday_value").value = data?.monday_value[0] || '0';
                    document.getElementById("tuesday_value").value = data?.tuesday_value[0] || '0';
                    document.getElementById("wednesday_value").value = data?.wednesday_value[0] || '0';
                    document.getElementById("thursday_value").value = data?.thursday_value[0] || '0';
                    document.getElementById("friday_value").value = data?.friday_value[0] || '0';
                    document.getElementById("saturday_value").value = data?.saturday_value[0] || '0';
                    document.getElementById("sunday_value").value = data?.sunday_value[0] || '0';
                    console.log("here1: ", data)
                    var totallength = (data.monday_value.length) 
                    
                    var tbody = document.getElementById("timeSheetForm").getElementsByTagName('table')[0].getElementsByTagName('tbody')[0];
                    var rows = tbody.getElementsByTagName("tr");
                    var taskNameRow = rows[rows.length - 6];
                    
                    for (var i = 1; i < totallength; i++) {
                        var newRow = document.createElement("tr");
                        newRow.style.backgroundColor = "#e0e0e0";                      
                        newRow.innerHTML += `
                        <td class="px-2 py-1 text-center"><input class="task-input" type="text" id="monday_task" name="monday_task" style="width: 100%" value="${data.tasks[i]}"</td>
                        <td class="px-2 py-1 text-center"><input class="monday_value" type="text" id="monday_value" name="monday_value" placeholder="0"   style="width: 50px; border:none;" value="${data.monday_value[i] || 0}"></td>
                        <td class="px-2 py-1 text-center"><input class="tuesday_value"  type="text" id="tuesday_value" name="tuesday_value"  placeholder="0" style="width: 50px; border:none;" value="${data.tuesday_value[i] || 0}"></td>
                        <td class="px-2 py-1 text-center"><input class="wednesday_value"  type="text" id="wednesday_value" name="wednesday_value" placeholder="0" style="width: 50px; border:none;" value="${data.wednesday_value[i] || 0}"></td>
                        <td class="px-2 py-1 text-center"><input class="thursday_value"  type="text" id="thursday_value" name="thursday_value" placeholder="0" style="width: 50px; border:none;" value="${data.thursday_value[i] || 0}" ></td>
                        <td class="px-2 py-1 text-center"><input class="friday_value"  type="text" id="friday_value" name="friday_value" placeholder="0"  style="width: 50px; border:none;" value="${data.friday_value[i] || 0}" ></td>
                        <td class="px-2 py-1 text-center"><input class="saturday_value"  type="text" id="saturday_value" name="saturday_value" placeholder="0"  style="width: 50px; border:none;" value="${data.saturday_value[i] || 0}" ></td>
                        <td class="px-2 py-1 text-center"><input class="sunday_value"  type="text" id="sunday_value" name="sunday_value" placeholder="0"  style="width: 50px; border:none;" value="${data.sunday_value[i] || 0}" ></td>       
                        `;
                        taskNameRow.parentNode.insertBefore(newRow, taskNameRow);
                    }
                }
                

                if (data?.project_name && data?.status!="Redo") {

                    // Removing buttons
                    document.getElementById("submitBtn").remove();
                    document.getElementById("discardBtn").remove();
                    document.getElementById("saveBtn").remove();
                    
                    // Making inputs read-only
                    document.getElementById("project_name").readOnly = true;
                    document.getElementById("monday_value").readOnly = true;
                    document.getElementById("tuesday_value").readOnly = true;
                    document.getElementById("wednesday_value").readOnly = true;
                    document.getElementById("thursday_value").readOnly = true;
                    document.getElementById("friday_value").readOnly = true;
                    document.getElementById("saturday_value").readOnly = true;
                    document.getElementById("sunday_value").readOnly = true;
                    document.getElementById("ovt_monday").readOnly = true;
                    document.getElementById("ovt_tuesday").readOnly = true;
                    document.getElementById("ovt_wednesday").readOnly = true;
                    document.getElementById("ovt_thursday").readOnly = true;
                    document.getElementById("ovt_friday").readOnly = true;
                    document.getElementById("ovt_saturday").readOnly = true;
                    document.getElementById("ovt_sunday").readOnly = true;
                    document.getElementById("St").readOnly = true;
                    document.getElementById("ot").readOnly = true;
                    document.getElementById("total_hour").readOnly = true;

                    // Creating the warning msg
                    var messageBox1 = document.createElement("div");
                    messageBox1.textContent = "* You have already Submitted the Time Sheet *";
                    messageBox1.classList.add("message1-box");
                    //document.body.appendChild(messageBox1);
                    // Get the parent element of the total hour input field
                    
                    var messageCell = document.getElementById("message").children[0];

                    // Append the message box to the table cell
                    messageCell.appendChild(messageBox1);

                }
                else{
                    if (data?.status!="Redo"){
                    console.log("else partition")
                    location.reload();}
                                }
                            

                    // fetch("{% url 'timesheets_create' %}", {
                    //     method: 'GET', // or 'POST', 'PUT', 'DELETE', etc. depending on your API
                    //     headers: {
                    //         'Content-Type': 'application/json', // set the appropriate content type
                    //         'X-CSRFToken': '{{ csrf_token }}'
                    //     },
                    //     // add a request body if required
                    //     })
                    
                
            });

        });

        console.log("camehere")
        var data1 = localStorage.getItem('tableData');         
        var formattedStartDate = startDate.toISOString().split('T')[0];
        var formattedEndDate = endDate.toISOString().split('T')[0];
        fetch("{% url 'timesheets_create' %}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({
                'start_date': formattedStartDate,
                'end_date': formattedEndDate,
                'method_1': "first_fetch"
            })
        })
        .then(response => response.json())
        .then(data => {
            console.log("here2")
            
            if (data ) {
            console.log('second')
                console.log("data", data)
                // data is not empty, create HTML elements to display the data
                let table = document.getElementById('yourTableId')
                document.getElementById("project_name").value = data?.project_name || '';
                document.getElementById("monday_value").value = data?.monday_value || '0';
                document.getElementById("tuesday_value").value = data?.tuesday_value || '0';
                document.getElementById("wednesday_value").value = data?.wednesday_value || '0';
                document.getElementById("thursday_value").value = data?.thursday_value || '0';
                document.getElementById("friday_value").value = data?.friday_value || '0';
                document.getElementById("saturday_value").value = data?.saturday_value || '0';
                document.getElementById("sunday_value").value = data?.sunday_value || '0';
                document.getElementById("ovt_monday").value = data?.ovt_monday || '0';
                document.getElementById("ovt_tuesday").value = data?.ovt_tuesday || '0';
                document.getElementById("ovt_wednesday").value = data?.ovt_wednesday || '0';
                document.getElementById("ovt_thursday").value = data?.ovt_thursday || '0';
                document.getElementById("ovt_friday").value = data?.ovt_friday || '0';
                document.getElementById("ovt_saturday").value = data?.ovt_saturday || '0';
                document.getElementById("ovt_sunday").value = data?.ovt_sunday || '0';
                document.getElementById("St").value = data?.St || '0';
                document.getElementById("ot").value = data?.ot || '0';
                document.getElementById("total_hour").value = data?.total_hour || '0';
                document.getElementById("th_monday").value = data?.th_hour[0] || '0';
                document.getElementById("th_tuesday").value = data?.th_hour[1] || '0';
                document.getElementById("th_wednesday").value = data?.th_hour[2] || '0';
                document.getElementById("th_thursday").value = data?.th_hour[3] || '0';
                document.getElementById("th_friday").value = data?.th_hour[4] || '0';
                document.getElementById("th_saturday").value = data?.th_hour[5] || '0';
                document.getElementById("th_sunday").value = data?.th_hour[6] || '0';

                console.log("here3")
                console.log(data.tasks.length)
                console.log(data.tasks)
                if (data.monday_value.length <= 1) {
                    document.getElementById("task").value = data?.tasks[0] || '0';
                    document.getElementById("monday_value").value = data?.monday_value[0] || '0';
                    document.getElementById("tuesday_value").value = data?.tuesday_value[0] || '0';
                    document.getElementById("wednesday_value").value = data?.wednesday_value[0] || '0';
                    document.getElementById("thursday_value").value = data?.thursday_value[0] || '0';
                    document.getElementById("friday_value").value = data?.friday_value[0] || '0';
                    document.getElementById("saturday_value").value = data?.saturday_value[0] || '0';
                    document.getElementById("sunday_value").value = data?.sunday_value[0] || '0';

                }
                else{
                    document.getElementById("task").value = data?.tasks[0] || '0';
                    document.getElementById("monday_value").value = data?.monday_value[0] || '0';
                    document.getElementById("tuesday_value").value = data?.tuesday_value[0] || '0';
                    document.getElementById("wednesday_value").value = data?.wednesday_value[0] || '0';
                    document.getElementById("thursday_value").value = data?.thursday_value[0] || '0';
                    document.getElementById("friday_value").value = data?.friday_value[0] || '0';
                    document.getElementById("saturday_value").value = data?.saturday_value[0] || '0';
                    document.getElementById("sunday_value").value = data?.sunday_value[0] || '0';
                    var totallength = (data.monday_value.length) 
                    
                    var tbody = document.getElementById("timeSheetForm").getElementsByTagName('table')[0].getElementsByTagName('tbody')[0];
                    var rows = tbody.getElementsByTagName("tr");
                    var taskNameRow = rows[rows.length - 6];
                    
                    for (var i = 1; i < totallength; i++) {
                        var newRow = document.createElement("tr");
                        newRow.style.backgroundColor = "#e0e0e0";                      
                        newRow.innerHTML += `
                        <td class="px-2 py-1 text-center"><input class="task-input" type="text" id="monday_task" name="monday_task" style="width: 100%" value="${data.tasks[i]}" readonly></td>
                        <td class="px-2 py-1 text-center"><input class="monday_value" type="text" id="monday_value" name="monday_value"    style="width: 50px; border:none;" value="${data.monday_value[i] || 0}" readonly></td>
                        <td class="px-2 py-1 text-center"><input class="tuesday_value"  type="text" id="tuesday_value" name="tuesday_value"   style="width: 50px; border:none;" value="${data.tuesday_value[i] || 0}" readonly></td>
                        <td class="px-2 py-1 text-center"><input class="wednesday_value"  type="text" id="wednesday_value" name="wednesday_value"  style="width: 50px; border:none;" value="${data.wednesday_value[i] || 0}" readonly></td>
                        <td class="px-2 py-1 text-center"><input class="thursday_value"  type="text" id="thursday_value" name="thursday_value"  style="width: 50px; border:none;" value="${data.thursday_value[i] || 0}" readonly></td>
                        <td class="px-2 py-1 text-center"><input class="friday_value"  type="text" id="friday_value" name="friday_value"  style="width: 50px; border:none;" value="${data.friday_value[i] || 0}" readonly></td>
                        <td class="px-2 py-1 text-center"><input class="saturday_value"  type="text" id="saturday_value" name="saturday_value"  style="width: 50px; border:none;" value="${data.saturday_value[i] || 0}" readonly></td>
                        <td class="px-2 py-1 text-center"><input class="sunday_value"  type="text" id="sunday_value" name="sunday_value"  style="width: 50px; border:none;" value="${data.sunday_value[i] || 0}" readonly></td>       
                        `;
                        taskNameRow.parentNode.insertBefore(newRow, taskNameRow);
                    }
                }

                if (data?.project_name && data?.status!="Redo") {
                    // Removing buttons
                    document.getElementById("submitBtn").remove();
                    document.getElementById("discardBtn").remove();
                    document.getElementById("saveBtn").remove();
                    
                    // Making inputs read-only
                    document.getElementById("project_name").readOnly = true;
                    document.getElementById("monday_value").readOnly = true;
                    document.getElementById("tuesday_value").readOnly = true;
                    document.getElementById("wednesday_value").readOnly = true;
                    document.getElementById("thursday_value").readOnly = true;
                    document.getElementById("friday_value").readOnly = true;
                    document.getElementById("saturday_value").readOnly = true;
                    document.getElementById("sunday_value").readOnly = true;
                    document.getElementById("ovt_monday").readOnly = true;
                    document.getElementById("ovt_tuesday").readOnly = true;
                    document.getElementById("ovt_wednesday").readOnly = true;
                    document.getElementById("ovt_thursday").readOnly = true;
                    document.getElementById("ovt_friday").readOnly = true;
                    document.getElementById("ovt_saturday").readOnly = true;
                    document.getElementById("ovt_sunday").readOnly = true;
                    document.getElementById("St").readOnly = true;
                    document.getElementById("ot").readOnly = true;
                    document.getElementById("total_hour").readOnly = true;

                    // Creating the warning msg
                    var messageBox1 = document.createElement("div");
                    messageBox1.textContent = "* You have already Submitted the Time Sheet *";
                    messageBox1.classList.add("message1-box");
                    //document.body.appendChild(messageBox1);
                    // Get the parent element of the total hour input field
                    
                    var messageCell = document.getElementById("message").children[0];

                    // Append the message box to the table cell
                    messageCell.appendChild(messageBox1);

                }
            
            }});   

            
    
    // Add event listener to project name input field
    var inputFields = document.querySelectorAll('input');
    inputFields.forEach(function(input) {
    input.addEventListener('keydown', function(event) {
        if (event.keyCode === 13) {
            event.preventDefault(); // Prevent form submission
            var nextInput = input.parentElement.nextElementSibling.querySelector('input');
            if (nextInput) {
                nextInput.focus(); // Move focus to the next field in the same row
            } 
        }
    });
});

    $(function() {


        // Calculate total hours
        function calculateTotalHours() {
            var total = 0;
            var st = 0;
            var ot = 0;
            var th_mon = 0;
            var th_tue = 0;
            var th_wed = 0;
            var th_thurs = 0;
            var th_fri = 0;
            var th_sat = 0;
            var th_sun = 0;
            
            $('input[class$="_value"], input[class^="ovt_"]').each(function() {
                var value = parseFloat($(this).val()) || 0;
                total += value;
            });
            $('input[class$="_value"]').each(function() {
                var value = parseFloat($(this).val()) || 0;
                st += value;
            });
            $('input[id^="ovt_"]').each(function() {
                var value = parseFloat($(this).val()) || 0;
                ot += value;
            });
            $('input[class$="monday_value"]').each(function() {
                var value = parseFloat($(this).val()) || 0;
                th_mon += value;
            });
            $('input[class$="tuesday_value"]').each(function() {
                var value = parseFloat($(this).val()) || 0;
                th_tue += value;
            });
            $('input[class$="wednesday_value"]').each(function() {
                var value = parseFloat($(this).val()) || 0;
                th_wed += value;
            });
            $('input[class$="thursday_value"]').each(function() {
                var value = parseFloat($(this).val()) || 0;
                th_thurs += value;
            });
            $('input[class$="friday_value"]').each(function() {
                var value = parseFloat($(this).val()) || 0;
                th_fri += value;
            });
            $('input[class$="saturday_value"]').each(function() {
                var value = parseFloat($(this).val()) || 0;
                th_sat += value;
            });
            $('input[class$="sunday_value"]').each(function() {
                var value = parseFloat($(this).val()) || 0;
                th_sun += value;
            });

            $('#St').val(st);
            $('#ot').val(ot);
            $('#total_hour').val(total);
            $('#th_monday').val(th_mon);
            $('#th_tuesday').val(th_tue);
            $('#th_wednesday').val(th_wed);
            $('#th_thursday').val(th_thurs);
            $('#th_friday').val(th_fri);
            $('#th_saturday').val(th_sat);
            $('#th_sunday').val(th_sun);
        }

        // Trigger calculation on input change
        $(document).on('input[class$="_value"], input[id^="ovt_"]').on('input', calculateTotalHours);
    });

    document.getElementById("discardBtn").addEventListener("click", function() {
        var confirmation = confirm("Are you sure you want to discard the values?")
    // Reset the input fields to their initial values
        if (confirmation) {
        document.getElementById("project_name").value = "";
        document.getElementById("monday_value").value = "";
        document.getElementById("tuesday_value").value = "";
        document.getElementById("wednesday_value").value = "";
        document.getElementById("thursday_value").value = "";
        document.getElementById("friday_value").value = "";
        document.getElementById("saturday_value").value = "";
        document.getElementById("sunday_value").value = "";
        document.getElementById("ovt_monday").value = "";
        document.getElementById("ovt_tuesday").value = "";
        document.getElementById("ovt_wednesday").value = "";
        document.getElementById("ovt_thursday").value = "";
        document.getElementById("ovt_friday").value = "";
        document.getElementById("ovt_saturday").value = "";
        document.getElementById("ovt_sunday").value = "";
        document.getElementById("St").value = "";
        document.getElementById("ot").value = "";
        document.getElementById("total_hour").value = "";
        document.getElementById('th_monday').value = "";
        document.getElementById('th_tuesday').value = "";
        document.getElementById('th_wednesday').value = "";
        document.getElementById('th_thursday').value = "";
        document.getElementById('th_friday').value = "";
        document.getElementById('th_saturday').value = "";
        document.getElementById('th_sunday').value = "";

       // Reset the task inputs to their initial values
       var taskInputs = document.querySelectorAll('.task-input');
        taskInputs.forEach((input) => {
            input.value = "";
        });
        // Remove the newly created rows
        

        // Remove the table data and task inputs from local storage
        localStorage.removeItem('tableData');
        localStorage.removeItem('taskInputs');
        location.reload();
}});
    document.getElementById("saveBtn").addEventListener("click", function() {
        // Get the table data
        var th_hour = [
                document.getElementById('th_monday').value,
                document.getElementById('th_tuesday').value,
                document.getElementById('th_wednesday').value,
                document.getElementById('th_thursday').value,
                document.getElementById('th_friday').value,
                document.getElementById('th_saturday').value,
                document.getElementById('th_sunday').value
            ];
        var tableData = {
            start_date: document.getElementById('start_date').value,
            end_date: document.getElementById('end_date').value,
            project_name: document.getElementById('project_name').value,
            ovt_monday: document.getElementById('ovt_monday').value,
            ovt_tuesday: document.getElementById('ovt_tuesday').value,
            ovt_wednesday: document.getElementById('ovt_wednesday').value,
            ovt_thursday: document.getElementById('ovt_thursday').value,
            ovt_friday: document.getElementById('ovt_friday').value,
            ovt_saturday: document.getElementById('ovt_saturday').value,
            ovt_sunday: document.getElementById('ovt_sunday').value,
            St: document.getElementById('St').value,
            ot: document.getElementById('ot').value,
            total_hour: document.getElementById('total_hour').value,
            th_hour: th_hour,
            
        };
        
        // Store the table data in local storage
        localStorage.setItem('tableData', JSON.stringify(tableData));
        var taskInputs = {
            monday_value : Array.from(document.querySelectorAll('.monday_value')).map(input => input.value),
            tuesday_value : Array.from(document.querySelectorAll('.tuesday_value')).map(input => input.value),
            wednesday_value : Array.from(document.querySelectorAll('.wednesday_value')).map(input => input.value),
            thursday_value : Array.from(document.querySelectorAll('.thursday_value')).map(input => input.value),
            friday_value : Array.from(document.querySelectorAll('.friday_value')).map(input => input.value),
            saturday_value : Array.from(document.querySelectorAll('.saturday_value')).map(input => input.value),
            sunday_value : Array.from(document.querySelectorAll('.sunday_value')).map(input => input.value),
            tasks : Array.from(document.querySelectorAll('.task-input')).map(input => input.value),
        }
        console.log("taskinputs:", taskInputs)
        localStorage.setItem('taskInputs', JSON.stringify(taskInputs));

        var messageBox = document.createElement("div");
        messageBox.textContent = "The Values are Saved";
        messageBox.classList.add("message-box");
        document.body.appendChild(messageBox);

        // Show the message box
        setTimeout(function() {
            messageBox.remove();
        }, 1700);
});

    document.getElementById("submitBtn").addEventListener("click", function() {
        event.preventDefault()

        var taskInputs = document.querySelectorAll('.task-input');
        var tasks = Array.from(taskInputs).map(input => input.value);
        var start_date = document.getElementById('start_date').value;
        var end_date = document.getElementById('end_date').value;
        var project_name = document.getElementById('project_name').value || '0';
        var monday_value = Array.from(document.querySelectorAll('.monday_value')).map(input => input.value) || '0';
        var tuesday_value = Array.from(document.querySelectorAll('.tuesday_value')).map(input => input.value) || '0';
        var wednesday_value = Array.from(document.querySelectorAll('.wednesday_value')).map(input => input.value) || '0';
        var thursday_value = Array.from(document.querySelectorAll('.thursday_value')).map(input => input.value) || '0';
        var friday_value = Array.from(document.querySelectorAll('.friday_value')).map(input => input.value) || '0';
        var saturday_value = Array.from(document.querySelectorAll('.saturday_value')).map(input => input.value) || '0';
        var sunday_value = Array.from(document.querySelectorAll('.sunday_value')).map(input => input.value) || '0';
        var th_hour = [
                document.getElementById('th_monday').value,
                document.getElementById('th_tuesday').value,
                document.getElementById('th_wednesday').value,
                document.getElementById('th_thursday').value,
                document.getElementById('th_friday').value,
                document.getElementById('th_saturday').value,
                document.getElementById('th_sunday').value
            ]; 
        var ovt_monday = document.getElementById('ovt_monday').value || '0';
        var ovt_tuesday = document.getElementById('ovt_tuesday').value || '0';
        var ovt_wednesday = document.getElementById('ovt_wednesday').value || '0';
        var ovt_thursday = document.getElementById('ovt_thursday').value || '0';
        var ovt_friday = document.getElementById('ovt_friday').value || '0';
        var ovt_saturday = document.getElementById('ovt_saturday').value || '0';
        var ovt_sunday = document.getElementById('ovt_sunday').value || '0';
        var St = document.getElementById('St').value || '0';
        var ot = document.getElementById('ot').value || '0';
        var total_hour = document.getElementById('total_hour').value || '0';
        

        
        
        
        // Get the form data
        //var formData = new FormData(document.getElementById("timeSheetForm"));

    // Send the form data to the server using fetch
    fetch("{% url 'timesheets_create' %}", {
                  // enter your url
        method: "POST",
        headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
        body: JSON.stringify({
                'start_date': start_date,
                'end_date': end_date,
                'project_name': project_name,
                'monday_value': monday_value,
                'tuesday_value': tuesday_value,
                'wednesday_value': wednesday_value,
                'thursday_value': thursday_value,
                'friday_value': friday_value,
                'saturday_value': saturday_value,
                'sunday_value': sunday_value,
                'th_hour': th_hour,
                'ovt_monday': ovt_monday,
                'ovt_tuesday': ovt_tuesday,
                'ovt_wednesday': ovt_wednesday,
                'ovt_thursday': ovt_thursday,
                'ovt_friday': ovt_friday,
                'ovt_saturday': ovt_saturday,
                'ovt_sunday': ovt_sunday,
                'St': St,
                'ot': ot,
                'total_hour': total_hour,
                'tasks': tasks,
                

            })
    })
    .then(function(response) {
        // Handle the response from the server
        if (response.ok) {
            return response.json();
            
        } else {
            throw new Error("Error: " + response.status);
        }
    })
    .then(function(data) {
        location.reload();
    })
    .catch(function(error) {
        // Handle any errors that occurred during the request
        console.error(error);
    });
        var messageBox_submit = document.createElement("div");
        messageBox_submit.textContent = "Time Sheet Submitted";
        messageBox_submit.classList.add("message-box");
        document.body.appendChild(messageBox_submit);

        // Show the message box
        setTimeout(function() {
            messageBox_submit.remove();
        }, 1700);
});
window.addEventListener('load', function() {
    
    var formattedStartDate = startDate.toISOString().split('T')[0];
        var formattedEndDate = endDate.toISOString().split('T')[0];
        fetch("{% url 'timesheets_create' %}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({
                'start_date': formattedStartDate,
                'end_date': formattedEndDate,
                'method_1': "first_fetch"
            })
        })
        .then(response => response.json())
        .then(data => {
            console.log("here5")
            if (!data.project_name){


    // Check if there is any saved table data in local storage
    var savedTableData = localStorage.getItem('tableData');
    var taskInputs = localStorage.getItem('taskInputs')
    console.log(savedTableData)
    console.log(taskInputs)
    if (savedTableData) {
        // Parse the saved table data
        var tableData = JSON.parse(savedTableData);

        // Populate the table with the saved data
        document.getElementById('start_date').value = tableData.start_date;
        document.getElementById('end_date').value = tableData.end_date;
        document.getElementById('project_name').value = tableData.project_name;
        
        document.getElementById('ovt_monday').value = tableData.ovt_monday;
        document.getElementById('ovt_tuesday').value = tableData.ovt_tuesday;
        document.getElementById('ovt_wednesday').value = tableData.ovt_wednesday;
        document.getElementById('ovt_thursday').value = tableData.ovt_thursday;
        document.getElementById('ovt_friday').value = tableData.ovt_friday;
        document.getElementById('ovt_saturday').value = tableData.ovt_saturday;
        document.getElementById('ovt_sunday').value = tableData.ovt_sunday;
        document.getElementById('St').value = tableData.St;
        document.getElementById('ot').value = tableData.ot;
        document.getElementById('total_hour').value = tableData.total_hour;

        document.getElementById('th_monday').value = tableData.th_hour[0];
        document.getElementById('th_tuesday').value = tableData.th_hour[1];
        document.getElementById('th_wednesday').value = tableData.th_hour[2];
        document.getElementById('th_thursday').value = tableData.th_hour[3];
        document.getElementById('th_friday').value = tableData.th_hour[4];
        document.getElementById('th_saturday').value = tableData.th_hour[5];
        document.getElementById('th_sunday').value = tableData.th_hour[6];

        var data = JSON.parse(localStorage.getItem('taskInputs'));
        console.log(data)
        if (data.monday_value.length <= 1) {
                    document.getElementById("task").value = data?.tasks[0] || '';
                    document.getElementById("monday_value").value = data?.monday_value[0] || '0';
                    document.getElementById("tuesday_value").value = data?.tuesday_value[0] || '0';
                    document.getElementById("wednesday_value").value = data?.wednesday_value[0] || '0';
                    document.getElementById("thursday_value").value = data?.thursday_value[0] || '0';
                    document.getElementById("friday_value").value = data?.friday_value[0] || '0';
                    document.getElementById("saturday_value").value = data?.saturday_value[0] || '0';
                    document.getElementById("sunday_value").value = data?.sunday_value[0] || '0';

        }
        else{
                    document.getElementById("task").value = data?.tasks[0] || '';
                    document.getElementById("monday_value").value = data?.monday_value[0] || '0';
                    document.getElementById("tuesday_value").value = data?.tuesday_value[0] || '0';
                    document.getElementById("wednesday_value").value = data?.wednesday_value[0] || '0';
                    document.getElementById("thursday_value").value = data?.thursday_value[0] || '0';
                    document.getElementById("friday_value").value = data?.friday_value[0] || '0';
                    document.getElementById("saturday_value").value = data?.saturday_value[0] || '0';
                    document.getElementById("sunday_value").value = data?.sunday_value[0] || '0';
                    var totallength = (data.monday_value.length) 
                    
                    var tbody = document.getElementById("timeSheetForm").getElementsByTagName('table')[0].getElementsByTagName('tbody')[0];
                    var rows = tbody.getElementsByTagName("tr");
                    var taskNameRow = rows[rows.length - 6];
                    
                    for (var i = 1; i < totallength; i++) {
                        var newRow = document.createElement("tr");
                        newRow.style.backgroundColor = "#e0e0e0";                      
                        newRow.innerHTML += `
                        <td class="px-2 py-1 text-center"><input class="task-input" type="text" id="monday_task" name="monday_task" style="width: 100%" value="${data.tasks[i] || 0}"></td>
                        <td class="px-2 py-1 text-center"><input class="monday_value" type="text" id="monday_value" name="monday_value"  style="width: 50px; border:none;" value="${data.monday_value[i] || 0}"></td>
                        <td class="px-2 py-1 text-center"><input class="tuesday_value"  type="text" id="tuesday_value" name="tuesday_value"  style="width: 50px; border:none;" value="${data.tuesday_value[i] || 0}"></td>
                        <td class="px-2 py-1 text-center"><input class="wednesday_value"  type="text" id="wednesday_value" name="wednesday_value" style="width: 50px; border:none;" value="${data.wednesday_value[i] || 0}"></td>
                        <td class="px-2 py-1 text-center"><input class="thursday_value"  type="text" id="thursday_value" name="thursday_value" style="width: 50px; border:none;" value="${data.thursday_value[i] || 0}"></td>
                        <td class="px-2 py-1 text-center"><input class="friday_value"  type="text" id="friday_value" name="friday_value"  style="width: 50px; border:none;" value="${data.friday_value[i] || 0}"></td>
                        <td class="px-2 py-1 text-center"><input class="saturday_value"  type="text" id="saturday_value" name="saturday_value"  style="width: 50px; border:none;" value="${data.saturday_value[i] || 0}"></td>
                        <td class="px-2 py-1 text-center"><input class="sunday_value"  type="text" id="sunday_value" name="sunday_value"  style="width: 50px; border:none;" value="${data.sunday_value[i] || 0}"></td>       
                        `;
                        taskNameRow.parentNode.insertBefore(newRow, taskNameRow);
                    }
        }

        
    }
}
        });
});
});
</script>
{% endblock ScriptBlock %}

